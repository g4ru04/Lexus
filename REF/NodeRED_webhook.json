[{
		"id": "92b8f04b.bb5d78",
		"type": "tab",
		"label": "LINE_WEBHOOK",
		"disabled": false,
		"info": ""
	}, {
		"id": "92820d3d.487bc8",
		"type": "tab",
		"label": "LINE_API",
		"disabled": false,
		"info": ""
	}, {
		"id": "952c8d23.7f0d4",
		"type": "tab",
		"label": "Surveillance",
		"disabled": false,
		"info": ""
	}, {
		"id": "61dca38d.78e234",
		"type": "cloudant",
		"z": "",
		"host": "c59d365e-26dc-4430-9f94-2ca4e20e5752-bluemix.cloudant.com",
		"name": "SERVICE-PROD2 çš„DB"
	}, {
		"id": "fb3184dc.08da7",
		"type": "http in",
		"z": "92b8f04b.bb5d78",
		"name": "",
		"url": "/lineAPI",
		"method": "post",
		"upload": false,
		"swaggerDoc": "",
		"x": 190,
		"y": 80,
		"wires": [["dd01ae44.3d755", "acfdb9e1.31704", "d9be9bc3.093978"]]
	}, {
		"id": "dd01ae44.3d755",
		"type": "http response",
		"z": "92b8f04b.bb5d78",
		"name": "",
		"statusCode": "200",
		"headers": {},
		"x": 430,
		"y": 100,
		"wires": []
	}, {
		"id": "35a9788d.20bdc8",
		"type": "function",
		"z": "92b8f04b.bb5d78",
		"name": "ä¾†æºé¡å‹",
		"func": "\nif(\n    msg.payload==null ||\n    msg.payload.events ==null ||\n    msg.payload.events[0]==null ||\n    msg.payload.events[0].source==null ||\n    msg.payload.events[0].source.type==null\n){\n    node.warn(\"éé æœŸè¨Šæ¯ä¾†æº?\");\n    return null;\n}\n\n\nif(msg.payload.events[0].source.type==\"user\"){\n    msg.target = msg.payload.events[0].source.userId;\n    msg.targetUser = msg.payload.events[0].source.userId;\n}else if(msg.payload.events[0].source.type==\"room\"){    \n    msg.target = msg.payload.events[0].source.roomId;\n    msg.targetUser = msg.payload.events[0].source.userId;\n}else if(msg.payload.events[0].source.type==\"group\"){\n    msg.target = msg.payload.events[0].source.groupId;\n    msg.targetUser = msg.payload.events[0].source.userId;\n}else{\n    node.warn(\"éé æœŸè¨Šæ¯ä¾†æº?\");\n    return null;\n}\n\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 590,
		"y": 180,
		"wires": [["b5e90d5c.de9f68", "b118e305.51cf9"]]
	}, {
		"id": "b5e90d5c.de9f68",
		"type": "function",
		"z": "92b8f04b.bb5d78",
		"name": "äº‹ä»¶é¡å‹",
		"func": "if(msg.payload.events[0].type==\"message\"){\n    \n    return [msg,null];\n    \n}else if(msg.payload.events[0].type==\"AAA\"){\n    node.warn(\"ä¸è™•ç†äº‹ä»¶é¡å‹?\");\n}else{\n    node.warn(\"ä¸è™•ç†äº‹ä»¶é¡å‹?\");\n    //åŒ…å«[follow unfollow join leave postback beacon accountLink]\n}\n\n\n\n",
		"outputs": 2,
		"noerr": 0,
		"x": 770,
		"y": 180,
		"wires": [["ab38a333.31aa38"], []]
	}, {
		"id": "acfdb9e1.31704",
		"type": "debug",
		"z": "92b8f04b.bb5d78",
		"name": "LINE_IN",
		"active": true,
		"tosidebar": true,
		"console": false,
		"tostatus": false,
		"complete": "true",
		"x": 430,
		"y": 60,
		"wires": []
	}, {
		"id": "6249a1dc.0f56e",
		"type": "http request",
		"z": "92b8f04b.bb5d78",
		"name": "",
		"method": "GET",
		"ret": "obj",
		"url": "",
		"tls": "",
		"x": 900,
		"y": 140,
		"wires": [["a755a19b.d1c21"]]
	}, {
		"id": "33c2ad9.62ed252",
		"type": "debug",
		"z": "92b8f04b.bb5d78",
		"name": "èª°!!!!",
		"active": false,
		"tosidebar": true,
		"console": false,
		"tostatus": false,
		"complete": "true",
		"x": 1180,
		"y": 140,
		"wires": []
	}, {
		"id": "b118e305.51cf9",
		"type": "function",
		"z": "92b8f04b.bb5d78",
		"name": "",
		"func": "\nlet token = msg.global_para.line_token;\n\nmsg.url = \"https://api.line.me/v2/bot/profile/\"+msg.targetUser;\nmsg.headers = {\n    \"Authorization\": \"Bearer \"+token,\n};\nif(msg.payload.events[0].message){\n    msg.temp = msg.payload.events[0].message.type==\"audio\"?\"å‚³äº†è²éŸ³ \"+msg.payload.events[0].message.id:msg.temp;\n    msg.temp = msg.payload.events[0].message.type==\"image\"?\"å‚³äº†åœ–ç‰‡ \"+msg.payload.events[0].message.id:msg.temp;\n    msg.temp = msg.payload.events[0].message.type==\"sticker\"?\"å‚³é€äº†è²¼åœ–[\"+msg.payload.events[0].message.packageId+\",\"+msg.payload.events[0].message.stickerId+\"]\":msg.temp;\n    msg.temp = msg.payload.events[0].message.type==\"text\"?\"èªªäº† \"+msg.payload.events[0].message.text:msg.temp;\n}else{\n    msg.temp = \"EVENT: \" + msg.payload.events[0].type;\n    \n}\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 760,
		"y": 140,
		"wires": [["6249a1dc.0f56e"]]
	}, {
		"id": "d9be9bc3.093978",
		"type": "function",
		"z": "92b8f04b.bb5d78",
		"name": "GLOBAL",
		"func": "\nmsg.global_para = {\n    line_token : \"Rr9TVtHn/xIiY7clM+hznaBRHv6r2Wbayq9enRSDwoWKmdGFo25NitxrjT1qgmTOPqCHZ/pLACxIYK/jhpogOP7p7apdL3+083YVer228EZlk1+eP3ILRFrzFUB9hacijo/1glbXcUMvdPgc+b+xoAdB04t89/1O/w1cDnyilFU=\",\n    my_host : \"https://nodered-api-lexus-test.mybluemix.net\"\n};\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 430,
		"y": 143,
		"wires": [["35a9788d.20bdc8"]]
	}, {
		"id": "a755a19b.d1c21",
		"type": "function",
		"z": "92b8f04b.bb5d78",
		"name": "ç™¼ç”Ÿï¼š",
		"func": "if(msg.payload.displayName){\n    msg.temp = msg.payload.displayName+\" : \"+msg.temp;\n}else{\n    msg.temp = msg.targetUser+\" : \"+msg.temp\n}\n\n//node.warn(msg.temp);\n\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 1060,
		"y": 140,
		"wires": [["33c2ad9.62ed252"]]
	}, {
		"id": "ab38a333.31aa38",
		"type": "switch",
		"z": "92b8f04b.bb5d78",
		"name": "è¨Šæ¯é¡å‹",
		"property": "payload.events[0].message.type",
		"propertyType": "msg",
		"rules": [{
				"t": "eq",
				"v": "text",
				"vt": "str"
			}, {
				"t": "eq",
				"v": "audio",
				"vt": "str"
			}, {
				"t": "eq",
				"v": "image",
				"vt": "str"
			}, {
				"t": "eq",
				"v": "sticker",
				"vt": "str"
			}, {
				"t": "eq",
				"v": "viedo",
				"vt": "str"
			}, {
				"t": "eq",
				"v": "file",
				"vt": "str"
			}, {
				"t": "eq",
				"v": "location",
				"vt": "str"
			}, {
				"t": "else"
			}
		],
		"checkall": "true",
		"repair": false,
		"outputs": 8,
		"x": 440,
		"y": 400,
		"wires": [["6f792c36.08f9dc"], ["afb92b10.278a18"], ["2bf18330.e89a04"], ["c708adac.b080d8"], ["c708adac.b080d8"], ["c708adac.b080d8"], ["c708adac.b080d8"], ["c708adac.b080d8"]]
	}, {
		"id": "cefc392b.760fb",
		"type": "debug",
		"z": "92b8f04b.bb5d78",
		"name": "è½‰ç™¼ API",
		"active": false,
		"tosidebar": true,
		"console": false,
		"tostatus": false,
		"complete": "true",
		"x": 1030,
		"y": 260,
		"wires": []
	}, {
		"id": "acd685f7.771678",
		"type": "http request",
		"z": "92b8f04b.bb5d78",
		"name": "",
		"method": "POST",
		"ret": "obj",
		"url": "",
		"tls": "",
		"x": 860,
		"y": 300,
		"wires": [["7a029671.04e578", "cefc392b.760fb"]]
	}, {
		"id": "6f792c36.08f9dc",
		"type": "function",
		"z": "92b8f04b.bb5d78",
		"name": "æ–‡",
		"func": "let user_context = context.flow.get(\"context-\"+msg.target);\nlet my_host = msg.global_para.my_host;\nmsg.url = my_host+\"/servicebot_conversation_1\"\nmsg.payload = {\n    type:\"text\",\n    message:msg.payload.events[0].message.text,\n    replyId:msg.target,\n    context:user_context,\n    //context:\"\",\n    token:\"b68d9f5a-9154-420e-9940-d67f721a16ec\"\n};\nmsg.headers = {'content-type':'application/json'};\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 640,
		"y": 300,
		"wires": [["acd685f7.771678"]]
	}, {
		"id": "c708adac.b080d8",
		"type": "function",
		"z": "92b8f04b.bb5d78",
		"name": "",
		"func": "let target = msg.target;\nlet messageTemplate=\n{\n    \"to\": target,\n    \"messages\":[\n        {\n            \"type\":\"text\",\n            \"text\":\"è¬è¬ä½ çš„è¨Šæ¯ï¼Œä¸éæˆ‘ç›®å‰ç„¡æ³•å›å¾©é€™é¡è¨Šæ¯å–”~\"\n        }\n    ]\n};\n\nmsg.retMsg = messageTemplate;\nreturn msg;\n",
		"outputs": 1,
		"noerr": 0,
		"x": 640,
		"y": 420,
		"wires": [["abcc5cc3.684638"]]
	}, {
		"id": "abcc5cc3.684638",
		"type": "function",
		"z": "92b8f04b.bb5d78",
		"name": "TOKEN",
		"func": "\nlet token = msg.global_para.line_token;\nmsg.payload = msg.retMsg;\n\nmsg.url = \"https://api.line.me/v2/bot/message/push\";\nmsg.headers = {\n    \"Content-Type\": \"application/json\",\n    \"Authorization\": \"Bearer \"+token,\n};\n\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 1210,
		"y": 340,
		"wires": [["c00783c.aee468", "c0afed0f.9abc28"]]
	}, {
		"id": "c00783c.aee468",
		"type": "http request",
		"z": "92b8f04b.bb5d78",
		"name": "SEND",
		"method": "POST",
		"ret": "txt",
		"url": "",
		"tls": "",
		"x": 1350,
		"y": 340,
		"wires": [["7fb8a799.9cef08"]]
	}, {
		"id": "d3119ad2.668d18",
		"type": "debug",
		"z": "92b8f04b.bb5d78",
		"name": "PUSH_TO_LINE",
		"active": true,
		"tosidebar": true,
		"console": false,
		"tostatus": false,
		"complete": "true",
		"x": 1530,
		"y": 400,
		"wires": []
	}, {
		"id": "e6b0a892.d0ec48",
		"type": "link in",
		"z": "92b8f04b.bb5d78",
		"name": "PIC_PERSHING_RETURN - B",
		"links": [],
		"x": 1015,
		"y": 400,
		"wires": [["abcc5cc3.684638"]]
	}, {
		"id": "7a029671.04e578",
		"type": "function",
		"z": "92b8f04b.bb5d78",
		"name": "CTX",
		"func": "let target = msg.target;\nmsg.payload.to = target;\n//node.warn(msg);\n/*let messageTemplate=\n{\n    \"to\": target,\n    \"messages\": msg.payload\n};\nmsg.retMsg = messageTemplate;\n*/\nmsg.retMsg = msg.payload;\ncontext.flow.set(\"context-\"+target,msg.payload.context);\nreturn msg;\n",
		"outputs": 1,
		"noerr": 0,
		"x": 1060,
		"y": 300,
		"wires": [["abcc5cc3.684638"]]
	}, {
		"id": "d6f98e5a.042ee8",
		"type": "http request",
		"z": "92b8f04b.bb5d78",
		"name": "",
		"method": "GET",
		"ret": "bin",
		"url": "",
		"tls": "",
		"x": 500,
		"y": 500,
		"wires": [["36693e7d.600a52"]]
	}, {
		"id": "d58a6735.502938",
		"type": "function",
		"z": "92b8f04b.bb5d78",
		"name": "",
		"func": "\nlet content_id = msg.payload.events[0].message.id;\nlet token = msg.global_para.line_token;\n\nmsg.url = \"https://api.line.me/v2/bot/message/\"+content_id+\"/content\";\n\nmsg.headers = {\n    \"Content-Type\": \"application/json\",\n    \"Authorization\": \"Bearer \"+token,\n};\n\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 350,
		"y": 500,
		"wires": [["d6f98e5a.042ee8"]]
	}, {
		"id": "6d1b9533.2ce93c",
		"type": "http in",
		"z": "92b8f04b.bb5d78",
		"name": "",
		"url": "/fetch_data",
		"method": "get",
		"upload": false,
		"swaggerDoc": "",
		"x": 490,
		"y": 580,
		"wires": [["36693e7d.600a52"]]
	}, {
		"id": "36693e7d.600a52",
		"type": "function",
		"z": "92b8f04b.bb5d78",
		"name": "######",
		"func": "if(\n    msg.req && \n    msg.req.route && \n    msg.req.route.path==\"/fetch_data\" &&\n    msg.payload.id\n){\n    let serial_id = new Buffer(msg.payload.id, 'base64').toString('utf-8')\n    \n    msg.headers = context.get(serial_id+\"_headers\");\n    if(msg.headers!=null){\n        msg.headers[\"content-disposition\"]=\"attachment; filename=audioclip-1532332559000-3971.mp4\";\n        msg.headers[\"content-type\"]=\"video/mp4\";\n    }\n    msg.payload = context.get(serial_id+\"_payload\");\n    context.set(serial_id+\"_headers\",null);\n    context.set(serial_id+\"_payload\",null);\n    return[null,msg];\n    //new Buffer(answer).toString('base64')\n}else{\n    let serial_id = UUID();\n    \n    context.set(serial_id+\"_headers\",msg.headers);\n    context.set(serial_id+\"_payload\",msg.payload);\n    \n    msg.dataIdBase64 = new Buffer(serial_id).toString('base64');\n    return[msg,null];\n}\n//return msg;\n\nfunction UUID() {\n  var d = Date.now();\n  if (typeof performance !== 'undefined' && typeof performance.now === 'function'){\n    d += performance.now(); //use high-precision timer if available\n  }\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n    var r = (d + Math.random() * 16) % 16 | 0;\n    d = Math.floor(d / 16);\n      return (c === 'x' ? r : (r & 0x3 | 0x8)).toString(16);\n  });\n}\n\n",
		"outputs": 2,
		"noerr": 0,
		"x": 680,
		"y": 540,
		"wires": [["e30a7a97.84adb8"], ["a4e590bf.38f78"]]
	}, {
		"id": "a4e590bf.38f78",
		"type": "http response",
		"z": "92b8f04b.bb5d78",
		"name": "",
		"statusCode": "200",
		"headers": {},
		"x": 850,
		"y": 580,
		"wires": []
	}, {
		"id": "afb92b10.278a18",
		"type": "function",
		"z": "92b8f04b.bb5d78",
		"name": "éŸ³",
		"func": "msg.type = \"audio\";\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 640,
		"y": 340,
		"wires": [["7220ecd7.3f422c"]]
	}, {
		"id": "2bf18330.e89a04",
		"type": "function",
		"z": "92b8f04b.bb5d78",
		"name": "åœ–",
		"func": "msg.type=\"image\";\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 640,
		"y": 380,
		"wires": [["7220ecd7.3f422c"]]
	}, {
		"id": "e30a7a97.84adb8",
		"type": "function",
		"z": "92b8f04b.bb5d78",
		"name": "RETURN",
		"func": "let user_context = context.flow.get(\"context-\"+msg.target);\nlet my_host = msg.global_para.my_host;\nmsg.url = my_host+\"/servicebot_conversation\"\nmsg.payload = {\n    type:msg.type,\n    //message: my_host+\"/fetch_data?id=\"+msg.dataIdBase64,\n    message: \"https://nodered-api-test.mybluemix.net/fetch_data?id=\"+msg.dataIdBase64,\n    context:user_context,\n    token:\"b68d9f5a-9154-420e-9940-d67f721a16ec\"\n};\n//node.warn(my_host+\"/fetch_data?id=\"+msg.dataIdBase64);\nmsg.headers = {'content-type':'application/json'};\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 830,
		"y": 520,
		"wires": [["b5414841.e9cb1"]]
	}, {
		"id": "df492b6f.5cb72",
		"type": "comment",
		"z": "92b8f04b.bb5d78",
		"name": "å–å›lineè³‡æ–™",
		"info": "",
		"x": 210,
		"y": 420,
		"wires": []
	}, {
		"id": "6ebd28a3.8580e",
		"type": "link in",
		"z": "92b8f04b.bb5d78",
		"name": "Line FetchData Retrun-N",
		"links": ["b5414841.e9cb1"],
		"x": 745,
		"y": 320,
		"wires": [["acd685f7.771678"]]
	}, {
		"id": "b5414841.e9cb1",
		"type": "link out",
		"z": "92b8f04b.bb5d78",
		"name": "Line FetchData Retrun-A",
		"links": ["6ebd28a3.8580e"],
		"x": 975,
		"y": 500,
		"wires": []
	}, {
		"id": "7220ecd7.3f422c",
		"type": "link out",
		"z": "92b8f04b.bb5d78",
		"name": "Line FetchData-A",
		"links": ["a023e842.077ca8"],
		"x": 745,
		"y": 360,
		"wires": []
	}, {
		"id": "a023e842.077ca8",
		"type": "link in",
		"z": "92b8f04b.bb5d78",
		"name": "Line FetchData-B",
		"links": ["7220ecd7.3f422c"],
		"x": 235,
		"y": 480,
		"wires": [["d58a6735.502938"]]
	}, {
		"id": "7fb8a799.9cef08",
		"type": "function",
		"z": "92b8f04b.bb5d78",
		"name": "PUSH_TO_LINE",
		"func": "if(msg.statusCode==200){\n    node.warn(\"ç™¼é€æˆåŠŸ\");\n}else{\n    node.warn(\"ç™¼é€å¤±æ•— for: \"+msg.payload);\n    //node.warn(msg);\n}\nreturn msg;",
		"outputs": 0,
		"noerr": 0,
		"x": 1530,
		"y": 340,
		"wires": []
	}, {
		"id": "c0afed0f.9abc28",
		"type": "debug",
		"z": "92b8f04b.bb5d78",
		"name": "BEFORE PUSH",
		"active": true,
		"tosidebar": true,
		"console": false,
		"tostatus": false,
		"complete": "true",
		"x": 1370,
		"y": 280,
		"wires": []
	}, {
		"id": "f43259ea.bcb0b",
		"type": "inject",
		"z": "92b8f04b.bb5d78",
		"name": "",
		"topic": "",
		"payload": "",
		"payloadType": "date",
		"repeat": "",
		"crontab": "",
		"once": false,
		"onceDelay": 0.1,
		"x": 330,
		"y": 800,
		"wires": [["30b16a66.3fbae6"]]
	}, {
		"id": "a9541863.73e7d",
		"type": "http request",
		"z": "92b8f04b.bb5d78",
		"name": "",
		"method": "POST",
		"ret": "txt",
		"url": "",
		"tls": "",
		"x": 866,
		"y": 800,
		"wires": [["d48be9d3.06cc2"]]
	}, {
		"id": "adf25d16.3d4bb",
		"type": "function",
		"z": "92b8f04b.bb5d78",
		"name": "CREATE",
		"func": "msg.url = \"https://api.line.me/v2/bot/richmenu\";\nmsg.headers = {\n    \"Content-Type\": \"application/json\",\n    \"Authorization\": \"Bearer \"+msg.flow_para.line_token,\n};\nmsg.payload = {\n    //https://s3-api.us-geo.objectstorage.softlayer.net/tytimage/LINE_images_test/rich_menu/richmenu.jpg\n    \"size\": {\n      \"width\": 2500,\n      \"height\": 1686\n    }, // 833 843\n    \"selected\": false,\n    \"name\": \"tyt_rich_menu\",\n    \"chatBarText\": \"æŸ¥çœ‹æ›´å¤šè³‡è¨Š\",\n    \"areas\": [\n      {\n        \"bounds\": {\n          \"x\": 0,\n          \"y\": 0,\n          \"width\":833,\n          \"height\": 843\n        },\n        \"action\": {  \n           \"type\":\"message\",\n           \"label\":\"å“ç‰Œæ´»å‹•\",\n           \"text\":\"å“ç‰Œæ´»å‹•\"\n        }\n      },{\n        \"bounds\": {\n          \"x\": 833,\n          \"y\": 0,\n          \"width\":833,\n          \"height\": 843\n        },\n        \"action\": {  \n           \"type\":\"message\",\n           \"label\":\"é„°è¿‘æ“šé»\",\n           \"text\":\"é„°è¿‘æ“šé»\"\n        }\n      },{\n        \"bounds\": {\n          \"x\": 1666,\n          \"y\": 0,\n          \"width\":833,\n          \"height\": 843\n        },\n        \"action\": {  \n           \"type\":\"message\",\n           \"label\":\"è¡Œå‹•å±•é–“\",\n           \"text\":\"è¡Œå‹•å±•é–“\"\n        }\n      },{\n        \"bounds\": {\n          \"x\": 0,\n          \"y\": 843,\n          \"width\":833,\n          \"height\": 843\n        },\n        \"action\": {  \n           \"type\":\"message\",\n           \"label\":\"è¡Œå‹•å®¢æœ\",\n           \"text\":\"è¡Œå‹•å®¢æœ\"\n        }\n      },{\n        \"bounds\": {\n          \"x\": 833,\n          \"y\": 843,\n          \"width\":833,\n          \"height\": 843\n        },\n        \"action\": {  \n           \"type\":\"message\",\n           \"label\":\"è¡Œè»Šç®¡å®¶\",\n           \"text\":\"è¡Œè»Šç®¡å®¶\"\n        }\n      },{\n        \"bounds\": {\n          \"x\": 1666,\n          \"y\": 843,\n          \"width\":833,\n          \"height\": 843\n        },\n        \"action\": {  \n           \"type\":\"message\",\n           \"label\":\"è»Šä¸»æœå‹™\",\n           \"text\":\"è»Šä¸»æœå‹™\"\n        }\n      }\n   ]\n}\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 670,
		"y": 800,
		"wires": [["a9541863.73e7d"]]
	}, {
		"id": "30b16a66.3fbae6",
		"type": "function",
		"z": "92b8f04b.bb5d78",
		"name": "",
		"func": "msg.flow_para = {\n    line_token : \"Rr9TVtHn/xIiY7clM+hznaBRHv6r2Wbayq9enRSDwoWKmdGFo25NitxrjT1qgmTOPqCHZ/pLACxIYK/jhpogOP7p7apdL3+083YVer228EZlk1+eP3ILRFrzFUB9hacijo/1glbXcUMvdPgc+b+xoAdB04t89/1O/w1cDnyilFU=\",\n    my_host : \"https://nodered-api-lexus-test.mybluemix.net\"\n};\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 500,
		"y": 800,
		"wires": [["adf25d16.3d4bb"]]
	}, {
		"id": "d48be9d3.06cc2",
		"type": "debug",
		"z": "92b8f04b.bb5d78",
		"name": "",
		"active": true,
		"tosidebar": true,
		"console": false,
		"tostatus": false,
		"complete": "true",
		"x": 1053,
		"y": 800,
		"wires": []
	}, {
		"id": "66ea6026.595b68",
		"type": "comment",
		"z": "92b8f04b.bb5d78",
		"name": "SET IMAGE",
		"info": "curl -v -X POST https://api.line.me/v2/bot/richmenu/richmenu-15524099dee76b3a67efb838b43a11ba/content -H \"Authorization: Bearer Rr9TVtHn/xIiY7clM+hznaBRHv6r2Wbayq9enRSDwoWKmdGFo25NitxrjT1qgmTOPqCHZ/pLACxIYK/jhpogOP7p7apdL3+083YVer228EZlk1+eP3ILRFrzFUB9hacijo/1glbXcUMvdPgc+b+xoAdB04t89/1O/w1cDnyilFU=\" -H \"Content-Type: image/jpeg\" -T richmenu.jpg",
		"x": 680,
		"y": 840,
		"wires": []
	}, {
		"id": "65f7aecf.ef2f4",
		"type": "comment",
		"z": "92b8f04b.bb5d78",
		"name": "SET DEFAULT",
		"info": "curl -v -X POST https://api.line.me/v2/bot/user/all/richmenu/richmenu-4ba4ee4ba10c122e434d62b044b64217 -d '' -H \"Authorization: Bearer Rr9TVtHn/xIiY7clM+hznaBRHv6r2Wbayq9enRSDwoWKmdGFo25NitxrjT1qgmTOPqCHZ/pLACxIYK/jhpogOP7p7apdL3+083YVer228EZlk1+eP3ILRFrzFUB9hacijo/1glbXcUMvdPgc+b+xoAdB04t89/1O/w1cDnyilFU=\"",
		"x": 930,
		"y": 840,
		"wires": []
	}, {
		"id": "fa07c6b1.5f4d",
		"type": "debug",
		"z": "92b8f04b.bb5d78",
		"name": "",
		"active": true,
		"tosidebar": true,
		"console": false,
		"tostatus": false,
		"complete": "true",
		"x": 1060,
		"y": 940,
		"wires": []
	}, {
		"id": "3d1f6329.f8057c",
		"type": "http request",
		"z": "92b8f04b.bb5d78",
		"name": "",
		"method": "POST",
		"ret": "txt",
		"url": "",
		"tls": "",
		"x": 873,
		"y": 940,
		"wires": [["fa07c6b1.5f4d"]]
	}, {
		"id": "594127ab.850278",
		"type": "function",
		"z": "92b8f04b.bb5d78",
		"name": "SET DEFAULT",
		"func": "msg.url = \"https://api.line.me/v2/bot/user/all/richmenu/richmenu-15524099dee76b3a67efb838b43a11ba\";\nmsg.headers = {\n    \"Content-Type\": \"application/json\",\n    \"Authorization\": \"Bearer \"+msg.flow_para.line_token,\n};\nmsg.payload={};\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 697,
		"y": 940,
		"wires": [["3d1f6329.f8057c"]]
	}, {
		"id": "b93b42dc.98c2d",
		"type": "function",
		"z": "92b8f04b.bb5d78",
		"name": "",
		"func": "msg.flow_para = {\n    line_token : \"Rr9TVtHn/xIiY7clM+hznaBRHv6r2Wbayq9enRSDwoWKmdGFo25NitxrjT1qgmTOPqCHZ/pLACxIYK/jhpogOP7p7apdL3+083YVer228EZlk1+eP3ILRFrzFUB9hacijo/1glbXcUMvdPgc+b+xoAdB04t89/1O/w1cDnyilFU=\",\n    my_host : \"https://nodered-api-lexus-test.mybluemix.net\"\n};\n\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 507,
		"y": 940,
		"wires": [["594127ab.850278"]]
	}, {
		"id": "f86dad28.3ca35",
		"type": "inject",
		"z": "92b8f04b.bb5d78",
		"name": "",
		"topic": "",
		"payload": "",
		"payloadType": "date",
		"repeat": "",
		"crontab": "",
		"once": false,
		"onceDelay": 0.1,
		"x": 337,
		"y": 940,
		"wires": [[]]
	}, {
		"id": "ae952a8d.07166",
		"type": "http in",
		"z": "92b8f04b.bb5d78",
		"name": "",
		"url": "/ht_api/LINE006_Q00",
		"method": "post",
		"upload": false,
		"swaggerDoc": "",
		"x": 390,
		"y": 1140,
		"wires": [["a2c34ce1.0b0c", "a12faeaf.005308"]]
	}, {
		"id": "a2c34ce1.0b0c",
		"type": "function",
		"z": "92b8f04b.bb5d78",
		"name": "custæŸ¥è©¢",
		"func": "\nmsg.payload = JSON.parse(msg.payload.jsonstr);\n\nmsg.payload = {\n    \"rtnCode\": \"0\",\n    \"rtnMsg\": \"\",\n    \"CSINFO\": [\n        {\n            \"LICSNO\": \"NUM-0\"+Math.abs(myHashCode(msg.payload.ENCYID)%100),\n            \"FRAN\": \"L\",\n            \"CARNM\": \"IS300h\",\n            \"CRCOMPID\": \"AA\",\n            \"CRSALR\": \"AA00001\",\n            \"CRSALRNM\": \"é™³æŸå»·\",\n            \"SRCOMPID\": \"AA\",\n            \"WHSRVNO\": \"AA00002\",\n            \"WHSRVNM\": \"åŠ‰å­Ÿå‡½\",\n            \"NICKNAME\": corresponse_name(msg.payload.ENCYID),\n            \"PICURL\": \"https://htsr.hotaimotor.com.tw/LINEAPI/IMG/user.jpg\"\n        }\n    ]\n}\n\nreturn msg;\n\nfunction corresponse_name(replyID){\n    let name_list = [\"æ¥Šå®å‰\",\"è³´æ–‡è±ª\",\"é„§æ·‘å¨Ÿ\",\"ä½™åèª \",\"é™³ä¸–é †\",\"æ—å®å„’\",\"è³´å“²è±ª\",\"é»ƒé›…æƒ \",\"é™³å˜‰é›¯\",\"æ¥Šä¸Šå’Œ\",\"åŠ‰è‚²å¨¥\",\"æ²ˆæ—å»·\",\"é„§æ€¡å¦‚\",\"è¶™äºå©·\",\"å¼µç®ç”„\",\"å³é›…æƒ \",\"å³ç´‹ç«\",\"å‘¨å¿—ç„¶\",\"èƒ¥æ­¡é›…\",\"é™³ä¿®æœ¨\",\"é™³ä¿Šæ†²\",\"å¼µå¿—éŠ˜\",\"åè‹¡ä½©\",\"æé®å¸†\",\"è—ç´ é †\",\"è¢å„’ç‘„\",\"é™³å›å‡½\",\"é™³å®¶è±ª\",\"é™³ä¿Šæ†²\",\"æ¶‚ç§‹æ·»\",\"å‘¨æ€¡æ¡‚\",\"é„­ä¼Šç„¶\",\"é™³æ€å¦ƒ\",\"é»ƒæƒ ç \",\"é»ƒæ˜ç¿°\",\"ç¾…é›…æ™´\",\"è”¡æ¶µéƒ\",\"è•­æ€¡å©·\",\"æ—æŸé’\",\"ç‹å§¿å­œ\",\"å®£åˆå¼·\",\"ææ™ºç¿”\",\"é™³å®¶è‹±\",\"æé³³å„’\",\"æäºˆæ·»\",\"å‘¨ç„èª \",\"è¨±å®‡ç¿”\",\"é»ƒé›…æ–‡\",\"ç‹ä½©ç’‡\",\"éƒ­å¹¼èƒ½\",\"é§±é›…å©·\",\"å³å‰å©·\",\"æ—æƒ å©·\",\"å³å£«éŠ˜\",\"æå®œç®\",\"æœæ€¡å›\",\"é„­éˆºå©·\",\"å¼µå¿—å¸†\",\"æ—é€²æ¾\",\"æ¶‚è±ªèˆœ\",\"å¼µå®¶å’Œ\",\"å¼µæƒ æ•\",\"é‡‘ç¾ç‰\",\"æ›¹ä¿Šç‘‹\",\"å³æ¬£å£«\",\"é»ƒä¿Šæ˜\",\"è¯é’å…¨\",\"é™³ä¾å©·\",\"é™³æ€¡å©·\",\"é™³ç›ˆå¦‚\",\"æ—å»ºå½°\",\"å³æ˜å®‰\",\"å³æ¹˜å©·\",\"æ—æƒ ç \",\"é™³å¤§å–¬\",\"é„­æ€¡å˜‰\",\"å€ªèƒ¤å¬Œ\",\"å®‹é›…çª\",\"éŒ¢è¾°å˜‰\",\"é™³æ™ºæ˜“\",\"å¾é‡‡ç››\",\"å¤ç›Šè¿ª\",\"é™³ä½³æ€¡\",\"ç™½èƒ¤ç´‹\",\"æé›…å©·\",\"æ—æ™ºç¿”\",\"å‚…å®¶è±ª\",\"å®“å£«å‡±\",\"å¼µç‘œæ¡“\",\"å–»ç¥¥ç„\",\"é™³å®éºŸ\",\"èƒ¡æ—å¸†\",\"é‚±å¿—ç¥¥\",\"å³é›…è¬™\",\"å¼µæ€¡ç«¹\",\"æ—éŸ‹æ¢…\",\"æœ±ä½©ç©\",\"æ´ªæ·‘å­£\",\"æå¿—ç­ \",\"è¬æ·»å£«\"];\n    \n    return name_list[Math.abs(myHashCode(replyID)%100)];\n}\nfunction myHashCode(str) {\n  var hash = 0, i, chr;\n  if (str.length === 0) return hash;\n  for (i = 0; i < str.length; i++) {\n    chr   = str.charCodeAt(i);\n    hash  = ((hash << 5) - hash) + chr;\n    hash |= 0; // Convert to 32bit integer\n  }\n  return hash;\n};",
		"outputs": 1,
		"noerr": 0,
		"x": 650,
		"y": 1140,
		"wires": [["aaac929b.3dde1"]]
	}, {
		"id": "aaac929b.3dde1",
		"type": "http response",
		"z": "92b8f04b.bb5d78",
		"name": "",
		"statusCode": "200",
		"headers": {},
		"x": 858,
		"y": 1140,
		"wires": []
	}, {
		"id": "dc57a23a.3fb54",
		"type": "http in",
		"z": "92b8f04b.bb5d78",
		"name": "",
		"url": "/ht_api/LINE006_Q01",
		"method": "post",
		"upload": false,
		"swaggerDoc": "",
		"x": 389,
		"y": 1188,
		"wires": [["818a69c3.cd63f8", "a12faeaf.005308"]]
	}, {
		"id": "818a69c3.cd63f8",
		"type": "function",
		"z": "92b8f04b.bb5d78",
		"name": "servåˆ—è¡¨",
		"func": "msg.payload = JSON.parse(msg.payload.jsonstr);\n\nmsg.payload = {\n    \"rtnCode\": \"0\",\n    \"rtnMsg\": \"\",\n    \"USERINFO\": [\n        {\n            \"LICSNO\": \"RBD-0021\",\n            \"FRAN\": \"L\",\n            \"CARNM\": \"IS300h\",\n            \"ENCYID\": \"C0001\",\n            \"MOBILE\": \"0919863010\",\n            \"NICKNAME\": \"æ¸¬è©¦ä½¿ç”¨è€…1\",\n            \"PICURL\": \"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQIGa49DabvTpQldi1JH7KHt2TeGFmn_3g4U2jAegFdvRLFunkYQg\",\n            \"FENDAT\": \"19000101\",\n            \"UENDAT\": \"19000101\",\n            \"BRTHDT\": \"19911111\",\n            \"FFLAG\": \"Y\",\n            \"UFLAG\": \"Y\",\n            \"BIRFLAG\": \"Y\",\n            \"USERID\": msg.payload.USERID\n        },\n        {\n            \"LICSNO\": \"RBD-0022\",\n            \"FRAN\": \"L\",\n            \"CARNM\": \"IS300h\",\n            \"ENCYID\": \"C0002\",\n            \"MOBILE\": \"0919863010\",\n            \"NICKNAME\": \"æ¸¬è©¦ä½¿ç”¨è€…2\",\n            \"PICURL\": \"https://im1.book.com.tw/image/getImage?i=https://www.books.com.tw/img/001/079/99/0010799970.jpg&v=5ba225b9&w=348&h=348\",\n            \"FENDAT\": \"19000101\",\n            \"UENDAT\": \"19000101\",\n            \"BRTHDT\": \"19911111\",\n            \"FFLAG\": \"Y\",\n            \"UFLAG\": \"Y\",\n            \"BIRFLAG\": \"Y\",\n            \"USERID\": msg.payload.USERID\n        },\n        {\n            \"LICSNO\": \"RBD-0023\",\n            \"FRAN\": \"L\",\n            \"CARNM\": \"IS300h\",\n            \"ENCYID\": \"C0003\",\n            \"MOBILE\": \"0919863010\",\n            \"NICKNAME\": \"æ¸¬è©¦ä½¿ç”¨è€…3\",\n            \"PICURL\": \"http://blog.accupass.com/wp-content/uploads/2017/03/1_120122230539_1.jpg\",\n            \"FENDAT\": \"19000101\",\n            \"UENDAT\": \"19000101\",\n            \"BRTHDT\": \"19911111\",\n            \"FFLAG\": \"Y\",\n            \"UFLAG\": \"Y\",\n            \"BIRFLAG\": \"Y\",\n            \"USERID\": msg.payload.USERID\n        }\n    ]\n}\n\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 649,
		"y": 1188,
		"wires": [["8790be9a.07e968"]]
	}, {
		"id": "8790be9a.07e968",
		"type": "http response",
		"z": "92b8f04b.bb5d78",
		"name": "",
		"statusCode": "200",
		"headers": {},
		"x": 857,
		"y": 1188,
		"wires": []
	}, {
		"id": "2688bd86.8c8d3a",
		"type": "http in",
		"z": "92b8f04b.bb5d78",
		"name": "",
		"url": "/ht_api/USER_LOGIN",
		"method": "post",
		"upload": false,
		"swaggerDoc": "",
		"x": 388,
		"y": 1235,
		"wires": [["628b4df2.a1c75c", "a12faeaf.005308"]]
	}, {
		"id": "628b4df2.a1c75c",
		"type": "function",
		"z": "92b8f04b.bb5d78",
		"name": "servç™»å…¥",
		"func": "msg.payload = JSON.parse(msg.payload.jsonstr);\n\nlet manager_dict = {\n    \"AA00001\":\"é™³æŸå»·\",\n    \"AA00002\":\"åŠ‰å­Ÿå‡½\",\n    \"AA94453\":\"é è¨­ç®¡ç†å“¡1\",\n    \"AA99061\":\"é è¨­ç®¡ç†å“¡2\"\n}\n\nmsg.payload = {\n    \"rtnCode\": \"0\",\n    \"rtnMsg\": \"\",\n    \"FLAG\": \"Y\",\n    \"COMPID\": \"AA\",\n    \"DLRCD\": \"A\",\n    \"BRNHCD\": \"01\",\n    \"SECTCD\": \"0\",\n    \"FRAN\": \"L\",\n    \"USERID\": msg.payload.USERID,\n    \"USERNM\": manager_dict[msg.payload.USERID],\n    \"ECHOTITLECD\": \"D\",\n    \"COMPSIMPNM\": \"åœ‹éƒ½æ±½è»Š\",\n    \"DEPTSIMPNM\": \"ä¸¹é³³æœå‹™å» \"\n}\n\nreturn msg;\n",
		"outputs": 1,
		"noerr": 0,
		"x": 648,
		"y": 1235,
		"wires": [["fcc72986.5af038"]]
	}, {
		"id": "fcc72986.5af038",
		"type": "http response",
		"z": "92b8f04b.bb5d78",
		"name": "",
		"statusCode": "200",
		"headers": {},
		"x": 856,
		"y": 1235,
		"wires": []
	}, {
		"id": "a12faeaf.005308",
		"type": "debug",
		"z": "92b8f04b.bb5d78",
		"name": "",
		"active": true,
		"tosidebar": true,
		"console": false,
		"tostatus": false,
		"complete": "true",
		"x": 640,
		"y": 1300,
		"wires": []
	}, {
		"id": "5e49e292.9208ec",
		"type": "http in",
		"z": "92820d3d.487bc8",
		"name": "",
		"url": "/servicebot_conversation",
		"method": "post",
		"upload": false,
		"swaggerDoc": "",
		"x": 328.566650390625,
		"y": 455,
		"wires": [["d976d502.688fd8"]]
	}, {
		"id": "2891cb43.bcbe94",
		"type": "switch",
		"z": "92820d3d.487bc8",
		"name": "TokenCheck",
		"property": "payload.token",
		"propertyType": "msg",
		"rules": [{
				"t": "eq",
				"v": "b68d9f5a-9154-420e-9940-d67f721a16ec",
				"vt": "str"
			}, {
				"t": "else"
			}
		],
		"checkall": "true",
		"repair": false,
		"outputs": 2,
		"x": 728.566650390625,
		"y": 375,
		"wires": [["a7fa95fb.0e5ea8", "12349448.2b14ec"], ["2fd56221.07aba6"]]
	}, {
		"id": "2fd56221.07aba6",
		"type": "template",
		"z": "92820d3d.487bc8",
		"name": "",
		"field": "payload",
		"fieldType": "msg",
		"format": "handlebars",
		"syntax": "mustache",
		"template": "{\n\t\"error\": {\n\t\t\"message\": \"Error validating token.\",\n\t\t\"type\": \"OAuthException\"\n\t}\n}\n",
		"output": "json",
		"x": 898.566650390625,
		"y": 415,
		"wires": [["89b71c2b.ef201", "c151879.ccea678"]]
	}, {
		"id": "a7fa95fb.0e5ea8",
		"type": "switch",
		"z": "92820d3d.487bc8",
		"name": "MsgFormatCheck",
		"property": "payload.type",
		"propertyType": "msg",
		"rules": [{
				"t": "eq",
				"v": "text",
				"vt": "str"
			}, {
				"t": "eq",
				"v": "image",
				"vt": "str"
			}, {
				"t": "eq",
				"v": "audio",
				"vt": "str"
			}, {
				"t": "else"
			}
		],
		"checkall": "true",
		"repair": false,
		"outputs": 4,
		"x": 918.566650390625,
		"y": 335,
		"wires": [["de7bb964.87525"], ["76dcf504.62534c"], ["14dc42c0.f297cd"], ["860a0644.5875f8"]]
	}, {
		"id": "89b71c2b.ef201",
		"type": "http response",
		"z": "92820d3d.487bc8",
		"name": "",
		"statusCode": "401",
		"headers": {},
		"x": 1058.566650390625,
		"y": 435,
		"wires": []
	}, {
		"id": "d434fc4e.92eb4",
		"type": "http response",
		"z": "92820d3d.487bc8",
		"name": "Response",
		"statusCode": "200",
		"headers": {},
		"x": 1508.566650390625,
		"y": 295,
		"wires": []
	}, {
		"id": "823c88da.d8b61",
		"type": "http response",
		"z": "92820d3d.487bc8",
		"name": "",
		"statusCode": "400",
		"headers": {},
		"x": 1298.566650390625,
		"y": 415,
		"wires": []
	}, {
		"id": "860a0644.5875f8",
		"type": "template",
		"z": "92820d3d.487bc8",
		"name": "",
		"field": "payload",
		"fieldType": "msg",
		"format": "handlebars",
		"syntax": "mustache",
		"template": "{\n\t\"error\": {\n\t\t\"message\": \"Unexception message type.\",\n\t\t\"type\": \"BadRequest\"\n\t}\n}\n",
		"output": "json",
		"x": 1118.566650390625,
		"y": 395,
		"wires": [["823c88da.d8b61", "6b6a8751.6a768"]]
	}, {
		"id": "925a6aa6.de0728",
		"type": "debug",
		"z": "92820d3d.487bc8",
		"name": "RequestMessage",
		"active": true,
		"tosidebar": true,
		"console": false,
		"tostatus": false,
		"complete": "true",
		"x": 588.566650390625,
		"y": 335,
		"wires": []
	}, {
		"id": "b18bb317.97598",
		"type": "debug",
		"z": "92820d3d.487bc8",
		"name": "ResponseMessage",
		"active": true,
		"tosidebar": true,
		"console": false,
		"tostatus": false,
		"complete": "true",
		"x": 1538.566650390625,
		"y": 255,
		"wires": []
	}, {
		"id": "b5026eb6.eea8e",
		"type": "function",
		"z": "92820d3d.487bc8",
		"name": "ContextDeal",
		"func": "msg.flow_config.time_record.response_time = Date.now();\n\nmsg.payload = msg.retMsg;\n\nlet context = null;\n//1.æœ€åŸºç¤æœ‰é€²ä¾†çš„context\n//2.å¦‚æœæœ‰å‡ºä¾† è€Œä¸”ä¸æ˜¯hardcodeçš„\ncontext = msg.req_para!=null && msg.req_para.context!=null\n            ? msg.req_para.context : context;\ncontext = msg.assistant_says!=null && msg.assistant_says.context!=null && msg.assistant_says.context.conversation_id!=null\n            ? msg.assistant_says.context : context;\n\nmsg.payload.context = context;\n\nif(msg.payload.context && msg.payload.context.doActions){\n    delete msg.payload.context.doActions;\n}\n\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 1288.566650390625,
		"y": 315,
		"wires": [["d434fc4e.92eb4", "b18bb317.97598", "760fdb37.0091e4"]]
	}, {
		"id": "de7bb964.87525",
		"type": "link out",
		"z": "92820d3d.487bc8",
		"name": "Line TextMessage IN - A",
		"links": ["ddb875c2.acfab8", "d0ca8756.0703a8"],
		"x": 1093.566650390625,
		"y": 275,
		"wires": []
	}, {
		"id": "8438b525.1e6c88",
		"type": "link out",
		"z": "92820d3d.487bc8",
		"name": "Line TextMessage OUT - B",
		"links": ["fbc5d702.244398"],
		"x": 953.566650390625,
		"y": 1195,
		"wires": []
	}, {
		"id": "fbc5d702.244398",
		"type": "link in",
		"z": "92820d3d.487bc8",
		"name": "Line TextMessage OUT - A",
		"links": ["8438b525.1e6c88", "71706500.b9b98c", "3b07f1f5.31025e"],
		"x": 1153.566650390625,
		"y": 275,
		"wires": [["b5026eb6.eea8e", "ab31ca9d.44487"]]
	}, {
		"id": "edf39080.fcc",
		"type": "link in",
		"z": "92820d3d.487bc8",
		"name": "è¯ç”Ÿèªª-B for 5",
		"links": ["ddda1664.1c09c8", "a5061e9.e31a1e", "bd2ff7d.1dff808", "9ec72007.14fdc8"],
		"x": 213.566650390625,
		"y": 1215,
		"wires": [["bdc701f2.a0be48"]]
	}, {
		"id": "73891008.fc269",
		"type": "switch",
		"z": "92820d3d.487bc8",
		"name": "",
		"property": "watson_doAction.type",
		"propertyType": "msg",
		"rules": [{
				"t": "eq",
				"v": "text",
				"vt": "str"
			}, {
				"t": "eq",
				"v": "my_btns",
				"vt": "str"
			}, {
				"t": "eq",
				"v": "carousel",
				"vt": "str"
			}, {
				"t": "eq",
				"v": "image_carousel",
				"vt": "str"
			}, {
				"t": "eq",
				"v": "buttons",
				"vt": "str"
			}, {
				"t": "eq",
				"v": "promote_activity",
				"vt": "str"
			}, {
				"t": "eq",
				"v": "some_menu",
				"vt": "str"
			}, {
				"t": "eq",
				"v": "special_coordinator",
				"vt": "str"
			}, {
				"t": "else"
			}
		],
		"checkall": "true",
		"repair": false,
		"outputs": 9,
		"x": 448.566650390625,
		"y": 1215,
		"wires": [["47ab978f.8e6ea"], ["d9b93388.a3853"], ["907e65f.04d5318"], ["b20a6cc1.59e26"], ["7a79aa85.150cc4"], ["d913ce2c.20f2c8"], ["a02b133c.97e238"], ["8529b27a.9f9a18"], ["63f0e1b9.1fef5"]]
	}, {
		"id": "47ab978f.8e6ea",
		"type": "function",
		"z": "92820d3d.487bc8",
		"name": "text",
		"func": "\nlet target = msg.target;\nlet messageTemplate=\n{\n    \"to\": target,\n    \"messages\":[\n        msg.watson_doAction\n        \n    ]\n};\nmsg.retMsg = messageTemplate;\nreturn msg;\n",
		"outputs": 1,
		"noerr": 0,
		"x": 728.5667724609375,
		"y": 1088,
		"wires": [["8438b525.1e6c88"]]
	}, {
		"id": "d9b93388.a3853",
		"type": "function",
		"z": "92820d3d.487bc8",
		"name": "my_btns",
		"func": "let target = msg.target;\nlet watson_doAction= msg.watson_doAction;\n\nlet btns =[];\nfor(let i=0;i<watson_doAction.buttonAssign.length;i++){\n    btns.push({\n\t\t\"type\": \"message\",\n\t\t\"label\": watson_doAction.buttonAssign[i],\n\t\t\"text\": watson_doAction.buttonAssign[i]\n\t});\n}\nwhile(btns.length>4){\n    btns.pop();\n}\n\nlet messageTemplate=\n{\n\t\"to\": target,\n\t\"messages\": [{\n\t\t\"type\": \"template\",\n\t\t\"altText\": watson_doAction.buttonTitle,\n\t\t\"template\": {\n\t\t\t\"type\": \"buttons\",\n\t\t\t\"text\": watson_doAction.buttonTitle,\n\t\t\t\"actions\": btns\n\t\t}\n\t}]\n};\n\nmsg.retMsg = messageTemplate;\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 737.5667724609375,
		"y": 1128,
		"wires": [["8438b525.1e6c88"]]
	}, {
		"id": "5ad89196.90b1b",
		"type": "comment",
		"z": "92820d3d.487bc8",
		"name": "Assistant",
		"info": "",
		"x": 198.566650390625,
		"y": 655,
		"wires": []
	}, {
		"id": "45def539.2ce82c",
		"type": "comment",
		"z": "92820d3d.487bc8",
		"name": "è¨Šæ¯è½‰Templateè™•ç†",
		"info": "",
		"x": 248.566650390625,
		"y": 1115,
		"wires": []
	}, {
		"id": "b280d94f.268ad8",
		"type": "comment",
		"z": "92820d3d.487bc8",
		"name": "API In",
		"info": "",
		"x": 208.566650390625,
		"y": 295,
		"wires": []
	}, {
		"id": "907e65f.04d5318",
		"type": "function",
		"z": "92820d3d.487bc8",
		"name": "carousel",
		"func": "let target = msg.target;\nlet watson_doAction= msg.watson_doAction;\n\n\nfor (let j = 0; watson_doAction.columns && j<watson_doAction.columns.length ; j++) {\n    \n    let column = watson_doAction.columns[j];\n    if(column.imageUrl!=null){\n        column.thumbnailImageUrl = column.imageUrl;\n        delete column.imageUrl;\n    }\n    if(column.actions && column.actions.length==1 && column.actions[0].type==\"uri\" && column.defaultAction==null){\n        column.defaultAction = column.actions[0];\n        delete column.imageUrl;\n    }\n    \n}\n\nlet messageTemplate=\n{\n\t\"to\": target,\n\t\"messages\": (watson_doAction.text\n\t?[{\n        \"type\":\"text\",\n        \"text\":watson_doAction.text\n    }]\n    :[]\n    ).concat(\n        [{\n    \t\t\"type\": \"template\",\n    \t\t\"altText\": watson_doAction.altText,\n    \t\t\"template\": {\n    \t\t\t\"type\": watson_doAction.type,\n    \t\t    \"imageAspectRatio\": watson_doAction.imageAspectRatio?watson_doAction.imageAspectRatio:\"rectangle\",//\"square\",\n                \"imageSize\": \"cover\",//\"contain\",\n    \t\t\t\"columns\": watson_doAction.columns,\n    \t\t}\n    \t}]\n\t)\n};\nmsg.retMsg = messageTemplate;\nreturn msg;\n",
		"outputs": 1,
		"noerr": 0,
		"x": 738.5665283203125,
		"y": 1165.25,
		"wires": [["8438b525.1e6c88"]]
	}, {
		"id": "bdc701f2.a0be48",
		"type": "function",
		"z": "92820d3d.487bc8",
		"name": "",
		"func": "if(Array.isArray(msg.watson_doActions) && msg.watson_doActions.length>0){\n    msg.watson_doAction = msg.watson_doActions[0];\n}\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 308.566650390625,
		"y": 1215,
		"wires": [["73891008.fc269"]]
	}, {
		"id": "63f0e1b9.1fef5",
		"type": "function",
		"z": "92820d3d.487bc8",
		"name": "anythingElse",
		"func": "\nmsg.retMsg = {};\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 748.566650390625,
		"y": 1475,
		"wires": [["8438b525.1e6c88"]]
	}, {
		"id": "b20a6cc1.59e26",
		"type": "function",
		"z": "92820d3d.487bc8",
		"name": "image_carousel",
		"func": "let target = msg.target;\nlet watson_doAction= msg.watson_doAction;\n\nlet messageTemplate=\n{\n\t\"to\": target,\n\t\"messages\": [{\n        \"type\":\"text\",\n        \"text\":watson_doAction.text\n    },{\n\t\t\"type\": \"template\",\n\t\t\"altText\": watson_doAction.altText,\n\t\t\"template\": {\n\t\t\t\"type\": watson_doAction.type,\n\t\t\t\"columns\": watson_doAction.columns,\n\t\t\t//\"imageSize\": \"cover\"\n\t\t}\n\t}]\n};\nmsg.retMsg = messageTemplate;\nreturn msg;\n",
		"outputs": 1,
		"noerr": 0,
		"x": 758.566650390625,
		"y": 1208,
		"wires": [["8438b525.1e6c88"]]
	}, {
		"id": "7a79aa85.150cc4",
		"type": "function",
		"z": "92820d3d.487bc8",
		"name": "buttons",
		"func": "let target = msg.target;\nlet watson_doAction= msg.watson_doAction;\n\nlet messageTemplate=\n{\n\t\"to\": target,\n\t\"messages\": [{\n\t\t\"type\": \"template\",\n\t\t\"altText\": watson_doAction.altText,\n\t\t\"template\": {\n\t\t\t\"type\": \"buttons\",\n\t\t\t\"text\": watson_doAction.text,\n\t\t\t\"actions\": watson_doAction.actions\n\t\t}\n\t}]\n};\n\nmsg.retMsg = messageTemplate;\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 728.566650390625,
		"y": 1250,
		"wires": [["8438b525.1e6c88"]]
	}, {
		"id": "667ebe39.4e2588",
		"type": "catch",
		"z": "92820d3d.487bc8",
		"name": "",
		"scope": ["5e49e292.9208ec", "63f0e1b9.1fef5", "b280d94f.268ad8", "5ad89196.90b1b", "14dc42c0.f297cd", "7a79aa85.150cc4", "907e65f.04d5318", "e8c7dcee.96e6c", "b5026eb6.eea8e", "12349448.2b14ec", "98169f83.c71a8", "27640eb.d6bc6f2", "9277f51.12b3f88", "b672a78c.cb5848", "bdc701f2.a0be48", "c69c6f61.1a7bf", "7f521b9a.fdb77c", "9e8c50e6.80bca8", "2e2e35e.527334a", "99d10caa.e4037", "de9a28be.2efb58", "7456d913.ac2d58", "6b6a8751.6a768", "c151879.ccea678", "e416fa27.9446d", "823c88da.d8b61", "89b71c2b.ef201", "b20a6cc1.59e26", "de7bb964.87525", "d0ca8756.0703a8", "fbc5d702.244398", "8438b525.1e6c88", "2e402ea.eb304d2", "b5175248.95a3c8", "dc0daa6.1f40858", "c2e992c9.184ca", "d913ce2c.20f2c8", "a7fa95fb.0e5ea8", "d9b93388.a3853", "76dcf504.62534c", "c06faf96.20aec", "760fdb37.0091e4", "925a6aa6.de0728", "d434fc4e.92eb4", "b18bb317.97598", "36001c1f.f3e78c", "993141cd.9061a8", "cf906e5d.e3f68", "a02b133c.97e238", "73891008.fc269", "2fd56221.07aba6", "860a0644.5875f8", "47ab978f.8e6ea", "2891cb43.bcbe94", "9e72530f.7ab01", "9ec72007.14fdc8", "edf39080.fcc", "45def539.2ce82c"],
		"x": 288.566650390625,
		"y": 135,
		"wires": [["6cce82ff.1db36c", "34b95e15.0970d2"]]
	}, {
		"id": "34b95e15.0970d2",
		"type": "function",
		"z": "92820d3d.487bc8",
		"name": "ERROR",
		"func": "\nlet timestamp = Date.now();\n\nmsg.payload = {\n    type:\"system_occurred\",\n    error: msg.error,\n    req_para: msg.req_para,\n    timestamp: timestamp,\n    time: new Date(new Date(timestamp).getTime()+8*3600*1000).toISOString().replace(\"T\",\" \").split(\".\")[0]\n};\n\nnode.status({fill:\"red\",shape:\"dot\",text:new Date(Date.now()+8*3600*1000).toISOString().replace(\"T\",\" \").split(\".\")[0]+JSON.stringify(msg.error)});\n\nif(msg.res){\n    return [msg,msg,{\n        payload:{\n            error_type:\"system_occurred\",\n            error:msg.error\n        }\n    }];\n}else{\n    return [msg,null,{\n        payload:{\n            error_type:\"system_occurred\",\n            error:msg.error\n        }\n    }];\n}",
		"outputs": 3,
		"noerr": 0,
		"x": 488.566650390625,
		"y": 115,
		"wires": [["5a0fc45.378e23c"], ["d76a01d0.4223b8"], ["d1d35fd4.26c8d8"]]
	}, {
		"id": "f41656fb.2f902",
		"type": "http response",
		"z": "92820d3d.487bc8",
		"name": "ERROR",
		"statusCode": "500",
		"headers": {},
		"x": 848.566650390625,
		"y": 154,
		"wires": []
	}, {
		"id": "d76a01d0.4223b8",
		"type": "template",
		"z": "92820d3d.487bc8",
		"name": "ERROR",
		"field": "payload",
		"fieldType": "msg",
		"format": "handlebars",
		"syntax": "mustache",
		"template": "{\n\t\"error\": {\n\t\t\"message\": \"Unexception error.\",\n\t\t\"type\": \"Internal Server Error\"\n\t}\n}\n",
		"output": "json",
		"x": 668.566650390625,
		"y": 135,
		"wires": [["f41656fb.2f902"]]
	}, {
		"id": "6cce82ff.1db36c",
		"type": "debug",
		"z": "92820d3d.487bc8",
		"name": "ERROR",
		"active": true,
		"tosidebar": true,
		"console": false,
		"tostatus": false,
		"complete": "true",
		"x": 478.566650390625,
		"y": 175,
		"wires": []
	}, {
		"id": "a02b133c.97e238",
		"type": "function",
		"z": "92820d3d.487bc8",
		"name": "some_menu",
		"func": "let target =  msg.target;\nlet HT_image_space = msg.flow_config.HT_image_space;\nlet imageMap = {\n  \"type\": \"imagemap\",\n  \"baseUrl\": HT_image_space+\"service_menu\",\n  \"altText\": \"TOYOTA_LINE_å€‹äººåŒ–æœå‹™\",\n  \"baseSize\": {\n      \"height\": 1040,\n      \"width\": 1040\n  },\n  \"actions\": [\n      {\n          //èªè­‰ä¸­å¤è»Š\n          \"type\": \"uri\",\n          \"linkUri\": \"https://www.toyota.com.tw/sh/\",\n          \"area\": {\n              \"x\": 1,\n              \"y\": 180,\n              \"width\": 518,\n              \"height\": 199\n          }\n      },\n      {\n          //é©…å‹•åŸå¸‚\n          \"type\": \"uri\",\n          \"linkUri\": \"https://www.toyota.com.tw/app/citydriver/\",\n          \"area\": {\n              \"x\": 522,\n              \"y\": 181,\n              \"width\": 518,\n              \"height\": 199\n          }\n      },\n      {\n          //TOYOTAç²¾å“\n          \"type\": \"uri\",\n          \"linkUri\": \"https://www.toyota.com.tw/collection.aspx\",\n          \"area\": {\n              \"x\": 0,\n              \"y\": 383,\n              \"width\": 519,\n              \"height\": 199\n          }\n      },\n      {\n          //FBç²‰å°ˆ\n          \"type\": \"uri\",\n          \"linkUri\": \"https://www.facebook.com/TOYOTA.Taiwan\",\n          \"area\": {\n              \"x\": 521,\n              \"y\": 383,\n              \"width\": 519,\n              \"height\": 200\n          }\n      },\n      {\n          //æ±½è»Šä¿éšª\n          \"type\": \"uri\",\n          \"linkUri\": \"https://ec.hotains.com.tw/\",\n          \"area\": {\n              \"x\": 1,\n              \"y\": 585,\n              \"width\": 518,\n              \"height\": 199\n          }\n      },\n      {\n          //IGå®˜æ–¹\n          \"type\": \"uri\",\n          \"linkUri\": \"https://www.instagram.com/toyotatw/\",\n          \"area\": {\n              \"x\": 522,\n              \"y\": 585,\n              \"width\": 518,\n              \"height\": 199\n          }\n      },\n      {\n          //æ±½è»Šè²¸æ¬¾\n          \"type\": \"uri\",\n          \"linkUri\": \"https://www.easypay.com.tw/02Inst1\",\n          \"area\": {\n              \"x\": 0,\n              \"y\": 786,\n              \"width\": 520,\n              \"height\": 254\n          }\n      },\n      {\n          //Youtubeé »é“\n          \"type\": \"uri\",\n          \"linkUri\": \"https://www.youtube.com/user/TOYOTA2012TW\",\n          \"area\": {\n              \"x\": 522,\n              \"y\": 787,\n              \"width\": 518,\n              \"height\": 253\n          }\n      }\n  ]\n};\n\nlet imageMapText = {\n    \"to\":target,\n    \"messages\":[\n        imageMap\n    ]\n};\n\nmsg.retMsg = imageMapText;\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 748.566650390625,
		"y": 1335,
		"wires": [["8438b525.1e6c88"]]
	}, {
		"id": "b672a78c.cb5848",
		"type": "function",
		"z": "92820d3d.487bc8",
		"name": "FlowConfig",
		"func": "msg.req_para = msg.payload;\n\nnode.status({fill:\"green\",shape:\"dot\",text:new Date(Date.now()+8*3600*1000).toISOString().replace(\"T\",\" \").split(\".\")[0]});\n\nmsg.flow_config = {\n    \"HT_API_host\":\"https://nodered-api-lexus-test.mybluemix.net/ht_api/\",\n    //\"HT_API_host\":\"https://htsr.hotaimotor.com.tw/LINEAPI_TEST/Service.asmx\",\n    \"HT_image_space\":\"https://s3-api.us-geo.objectstorage.softlayer.net/tytimage/LINE_images_test/\",\n    //\"HT_image_space\": \"https://s3-api.us-geo.objectstorage.softlayer.net/tytimage01/LINE_images_prod/\",\n    \"one_on_one_host\":\"http://192.168.43.43:8080/\",\n    \"watson_config\": [{\n        \"name\":\"Develop Assistant\",\n        \"workspaceId\": '234bf172-8356-42cc-8ec3-cb0a3dc69a0c',\n        \"username\": \"4003aefc-79f8-4c14-a497-f720829da4f0\",\n        \"password\": \"ZYqZvVngtxaX\"\n    }],\n    \"time_record\":{\n        request_time: Date.now()\n    }\n};\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 568.566650390625,
		"y": 375,
		"wires": [["2891cb43.bcbe94"]]
	}, {
		"id": "760fdb37.0091e4",
		"type": "function",
		"z": "92820d3d.487bc8",
		"name": "Record",
		"func": "\nif(msg.payload!=null &&\n    msg.payload.context!=null &&\n    msg.payload.context.car_model_info\n){  //è¼¸å‡ºcontext\n    msg.payload.context.car_model_info=\"Been reduced.\";\n}\n\nlet watson_says = msg.assistant_says!=null && \n                    msg.assistant_says.output!=null && \n                    msg.assistant_says.output.text!=null\n                    ?msg.assistant_says.output.text.join(\"\"):\"\";\n\nlet timestamp = Date.now();\n\nlet watson_assistant_out = null;\nif(msg.assistant_says!=null && !msg.passWatson){\n    watson_assistant_out = msg.assistant_says;\n    watson_assistant_out.workspaceId = msg.flow_config.usedWorkspace;\n    watson_assistant_out.watsonName = msg.flow_config.usedWatsonName;\n}\n\nreturn {\n    payload:Object.assign(\n        msg.flow_config.time_record,\n        {\n            watson_assistant_out:watson_assistant_out\n        },\n        {\n            input: msg.req_para.message,\n            output: msg.payload,\n            outputStr: watson_says,\n            timestamp:timestamp,\n            time : new Date(timestamp+8*3600*1000).toISOString().replace(\"T\",\" \").split(\".\")[0],\n        }\n    )\n};",
		"outputs": 1,
		"noerr": 0,
		"x": 1484.449951171875,
		"y": 354.0333251953125,
		"wires": [["c2e992c9.184ca"]]
	}, {
		"id": "e8c7dcee.96e6c",
		"type": "catch",
		"z": "92820d3d.487bc8",
		"name": "",
		"scope": ["ed624382.d8f38", "ff66555c.8c77a8", "5f00487f.cbe7f8"],
		"x": 558.566650390625,
		"y": 975,
		"wires": [["9277f51.12b3f88"]]
	}, {
		"id": "9277f51.12b3f88",
		"type": "function",
		"z": "92820d3d.487bc8",
		"name": "ERROR_RESPONSE",
		"func": "\nif(msg.req_para.context==null || typeof msg.req_para.context !=\"object\"){\n    msg.req_para.context = {};\n}\nmsg.req_para.context.doActions = [{\"text\":\"å¦‚æœ‰è³¼è»Šéœ€æ±‚ï¼Œæ­¡è¿å‰å¾€å…¨å°å±•ç¤ºä¸­å¿ƒï¼Œç¶­ä¿®ä¿é¤Šè«‹æ´½æœå‹™å» ï¼Œæˆ–é»é¸ç·šä¸Šæ–‡å­—å®¢æœï¼Œç”±å°ˆäººç‚ºæ‚¨æœå‹™å”·ï¼Œæ„Ÿè¬æ‚¨çš„è©¢å•ğŸ˜Š\",\"type\":\"buttons\",\"actions\":[{\"uri\":\"http://www.toyota.com.tw/location.aspx\",\"type\":\"uri\",\"label\":\"å…¨å°å±•ç¤ºä¸­å¿ƒ\"},{\"uri\":\"https://www.toyota.com.tw/dealer.aspx\",\"type\":\"uri\",\"label\":\"TOYOTAæœå‹™å» \"},{\"uri\":\"https://csonline.hotaimotor.com.tw/index.php\",\"type\":\"uri\",\"label\":\"ç·šä¸Šæ–‡å­—å®¢æœ\"}],\"altText\":\"å¦‚æœ‰è³¼è»Šéœ€æ±‚ï¼Œæ­¡è¿å‰å¾€å…¨å°å±•ç¤ºä¸­å¿ƒï¼Œç¶­ä¿®ä¿é¤Šè«‹æ´½æœå‹™å» ï¼Œæˆ–é»é¸ç·šä¸Šæ–‡å­—å®¢æœï¼Œç”±å°ˆäººç‚ºæ‚¨æœå‹™å”·ï¼Œæ„Ÿè¬æ‚¨çš„è©¢å•ğŸ˜Š\"}];\n\nmsg.payload = {\n\t\"intents\": [],\n\t\"entities\": [],\n\t\"input\": {\n\t\t\"text\": msg.req_para.message\n\t},\n\t\"output\": {\n\t\t\"text\": [\"\"],//Assistantç™¼ç”Ÿç•°å¸¸Error\n\t},\n\t\"context\": msg.req_para.context\n};\n\nlet timestamp = Date.now();\nnode.status({fill:\"red\",shape:\"dot\",text:new Date(Date.now()+8*3600*1000).toISOString().replace(\"T\",\" \").split(\".\")[0]+JSON.stringify(msg.error)});\nreturn[msg,{\n    payload:{\n        type: \"watson_throw\",\n        error: msg.error,\n        req_para: msg.req_para,\n        timestamp: timestamp,\n        time: new Date(new Date(timestamp).getTime()+8*3600*1000).toISOString().replace(\"T\",\" \").split(\".\")[0],\n        msgID:msg.msgID\n    }\n},{\n    payload:{\n        error_type:\"watson_throw\",\n        error:msg.error\n    }\n}];\n",
		"outputs": 3,
		"noerr": 0,
		"x": 728.566650390625,
		"y": 975,
		"wires": [["2e2e35e.527334a"], ["9e578843.045aa8"], ["960e42ce.fb19e8", "615342af.4734ac"]]
	}, {
		"id": "98169f83.c71a8",
		"type": "comment",
		"z": "92820d3d.487bc8",
		"name": "Deploy remind",
		"info": "ERRORæœ‰å…­å€‹é»ä¸åŒ…å«\näº”å€‹errorä¸‹çš„å­ç¯€é»\nASSISTANT service",
		"x": 368.566650390625,
		"y": 75,
		"wires": []
	}, {
		"id": "d913ce2c.20f2c8",
		"type": "function",
		"z": "92820d3d.487bc8",
		"name": "lottery_pic(æ­£æ¸¬ä¸ä¸€)",
		"func": "let target =  msg.target;\nlet HT_image_space = msg.flow_config.HT_image_space;\nlet imageMap = {\n  \"type\": \"imagemap\",\n \n  \"baseUrl\": HT_image_space+\"promote_activity\",\n  \"altText\": \"TOYOTA LINEæ­¡æ…¶é–‹å°åˆ®åˆ®æ¨‚ï¼ŒæŠ½æ²–ç¹©æ„›çš„å¤§å†’éšª âœ¨\",\n  \"baseSize\": {\n      \"height\": 1040,\n      \"width\": 1040\n  },\n  \"actions\": [\n      {\n          \"type\": \"uri\",\n          \"linkUri\": \"https://toyotadev.gadclubs.com/zh_TW/hotaimotor_verify_event\",\n          \"area\": {\n              \"x\": 0,\n              \"y\": 0,\n              \"width\": 1040,\n              \"height\": 1040\n          }\n      }\n  ]\n};\n\nlet imageMapText = {\n    \"to\":target,\n    \"messages\":[\n        imageMap\n    ]\n};\n\nmsg.retMsg = imageMapText;\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 778.566650390625,
		"y": 1295,
		"wires": [["8438b525.1e6c88"]]
	}, {
		"id": "27640eb.d6bc6f2",
		"type": "comment",
		"z": "92820d3d.487bc8",
		"name": "Error handling",
		"info": "",
		"x": 188.566650390625,
		"y": 74,
		"wires": []
	}, {
		"id": "14dc42c0.f297cd",
		"type": "function",
		"z": "92820d3d.487bc8",
		"name": "Audio",
		"func": "msg.retMsg={\n    \"to\": \"\",\n    \"messages\":[\n        {\n            \"type\":\"text\",\n            \"text\":\"æŠ±æ­‰æˆ‘è½ä¸å¤ªæ‡‚ï¼Œå¯ä»¥ç”¨æ–‡å­—å‘Šè¨´æˆ‘å—?\"\n        }\n    ],\n    \"context\":msg.req_para.context\n};\n\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 1108.566650390625,
		"y": 355,
		"wires": [["b5026eb6.eea8e"]]
	}, {
		"id": "76dcf504.62534c",
		"type": "function",
		"z": "92820d3d.487bc8",
		"name": "Picture",
		"func": "msg.retMsg={\n    \"to\": \"\",\n    \"messages\":[\n        {\n            \"type\":\"text\",\n            \"text\":\"æŠ±æ­‰æˆ‘çœ‹ä¸æ‡‚åœ–ç‰‡ï¼Œå¯ä»¥ç”¨æ–‡å­—å‘Šè¨´æˆ‘å—?\"\n        }\n    ],\n    \"context\":msg.req_para.context\n};\n\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 1108.566650390625,
		"y": 315,
		"wires": [["b5026eb6.eea8e"]]
	}, {
		"id": "2e402ea.eb304d2",
		"type": "ibmiot out",
		"z": "92820d3d.487bc8",
		"authentication": "boundService",
		"apiKey": "",
		"outputType": "evt",
		"deviceId": "TaipeiDigital",
		"deviceType": "robot",
		"eventCommandType": "SaveCloudantLog",
		"format": "json",
		"data": "msg.payload",
		"qos": 0,
		"name": "Log",
		"service": "registered",
		"x": 1428.566650390625,
		"y": 475,
		"wires": []
	}, {
		"id": "12349448.2b14ec",
		"type": "function",
		"z": "92820d3d.487bc8",
		"name": "ContextFormatMail",
		"func": "if(msg.payload!=null && msg.payload.context!=null && typeof msg.payload.context!=\"object\"){\n    return msg;\n}\n",
		"outputs": 1,
		"noerr": 0,
		"x": 938.566650390625,
		"y": 275,
		"wires": [["b5175248.95a3c8"]]
	}, {
		"id": "b5175248.95a3c8",
		"type": "ibmiot out",
		"z": "92820d3d.487bc8",
		"authentication": "boundService",
		"apiKey": "",
		"outputType": "evt",
		"deviceId": "TaipeiDigital",
		"deviceType": "robot",
		"eventCommandType": "SendMail",
		"format": "json",
		"data": "msg.payload",
		"qos": 0,
		"name": "Log",
		"service": "registered",
		"x": 1128.566650390625,
		"y": 235,
		"wires": []
	}, {
		"id": "36001c1f.f3e78c",
		"type": "function",
		"z": "92820d3d.487bc8",
		"name": "Set 1st Assistant cfg",
		"func": "let workspace = msg.flow_config.watson_config[0];\nmsg.payload = msg.req_para.message;\nmsg.params = {\n    workspace_id: workspace.workspaceId,\n    username: workspace.username,\n    password: workspace.password,\n    context: msg.req_para.context\n};\n\nmsg.flow_config.usedWorkspace = workspace.workspaceId;\nmsg.flow_config.usedWatsonName = workspace.name;\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 428.566650390625,
		"y": 815,
		"wires": [["ed624382.d8f38"]]
	}, {
		"id": "ed624382.d8f38",
		"type": "watson-conversation-v1",
		"z": "92820d3d.487bc8",
		"name": "",
		"workspaceid": "",
		"multiuser": true,
		"context": false,
		"empty-payload": false,
		"default-endpoint": true,
		"service-endpoint": "https://gateway.watsonplatform.net/conversation/api",
		"timeout": "",
		"optout-learning": false,
		"x": 638.566650390625,
		"y": 815,
		"wires": [["c69c6f61.1a7bf", "6437607d.b67d58"]]
	}, {
		"id": "c69c6f61.1a7bf",
		"type": "function",
		"z": "92820d3d.487bc8",
		"name": "",
		"func": "if(\n    msg.payload && \n    msg.payload.output && \n    msg.payload.output.text && \n    msg.payload.output.text[0] && \n    msg.payload.output.text[0]==\"æˆ‘ç„¡æ³•å›ç­”æ­¤å•é¡Œ\" \n){\n    return [null,msg];\n}else{\n    return [msg,null];\n}",
		"outputs": 2,
		"noerr": 0,
		"x": 788.566650390625,
		"y": 815,
		"wires": [["2e2e35e.527334a"], ["2e2e35e.527334a"]]
	}, {
		"id": "993141cd.9061a8",
		"type": "function",
		"z": "92820d3d.487bc8",
		"name": "Set 2nd Assistant cfg",
		"func": "let workspace = msg.flow_config.watson_config[1];\nmsg.payload = msg.req_para.message;\nmsg.params = {\n    workspace_id: workspace.workspaceId,\n    username: workspace.username,\n    password: workspace.password,\n    context: msg.req_para.context\n};\n\nmsg.flow_config.usedWorkspace = workspace.workspaceId;\nmsg.flow_config.usedWatsonName = workspace.name;\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 418.566650390625,
		"y": 872,
		"wires": [["ff66555c.8c77a8"]]
	}, {
		"id": "ff66555c.8c77a8",
		"type": "watson-conversation-v1",
		"z": "92820d3d.487bc8",
		"name": "",
		"workspaceid": "",
		"multiuser": true,
		"context": false,
		"empty-payload": false,
		"default-endpoint": true,
		"service-endpoint": "https://gateway.watsonplatform.net/conversation/api",
		"timeout": "",
		"optout-learning": false,
		"x": 638.566650390625,
		"y": 872,
		"wires": [["7f521b9a.fdb77c"]]
	}, {
		"id": "7f521b9a.fdb77c",
		"type": "function",
		"z": "92820d3d.487bc8",
		"name": "",
		"func": "if(\n    msg.payload && \n    msg.payload.output && \n    msg.payload.output.text && \n    msg.payload.output.text[0] && \n    msg.payload.output.text[0]==\"æˆ‘ç„¡æ³•å›ç­”æ­¤å•é¡Œ\" \n){\n    return [null,msg];\n}else{\n    return [msg,null];\n}",
		"outputs": 2,
		"noerr": 0,
		"x": 788.566650390625,
		"y": 872,
		"wires": [["2e2e35e.527334a"], ["2e2e35e.527334a"]]
	}, {
		"id": "d0ca8756.0703a8",
		"type": "link in",
		"z": "92820d3d.487bc8",
		"name": "Line TextMessage IN - B",
		"links": ["de7bb964.87525"],
		"x": 353.566650390625,
		"y": 695,
		"wires": [["99d10caa.e4037"]]
	}, {
		"id": "2e2e35e.527334a",
		"type": "function",
		"z": "92820d3d.487bc8",
		"name": "",
		"func": "msg.flow_config.time_record.assistant_return = Date.now();\nmsg.assistant_says = msg.payload;\n\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 968.566650390625,
		"y": 855,
		"wires": [["de9a28be.2efb58", "7456d913.ac2d58", "be2a8208.cae518"]]
	}, {
		"id": "99d10caa.e4037",
		"type": "function",
		"z": "92820d3d.487bc8",
		"name": "",
		"func": "msg.req_para.message = msg.req_para.message!=null?msg.req_para.message.toUpperCase().replace(/[\\t\\n\\r]/g,\"\"):\" \";\nmsg.target = msg.req_para.replyId;\nif(Array.isArray(msg.req_para.context)){\n    msg.req_para.context = null;\n}\nmsg.flow_config.time_record.assistant_call = Date.now();\nnode.status({fill:\"green\",shape:\"dot\",text:msg.req_para.message});\nnode.warn(\"says: \"+msg.req_para.message);\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 488.566650390625,
		"y": 695,
		"wires": [["e416fa27.9446d"]]
	}, {
		"id": "e416fa27.9446d",
		"type": "function",
		"z": "92820d3d.487bc8",
		"name": "HardCodeResponse",
		"func": "\nlet hard_response = hard_code_response_check(msg.req_para.message);\n\nif( hard_response!=null){\n    \n    if(msg.req_para.context==null || typeof msg.req_para.context !=\"object\"){\n        msg.req_para.context = {};\n    }\n    let output_text = \"\";\n    output_text = hard_response[0].type?hard_response[0].type+\" template\":output_text;\n    output_text = hard_response[0].altText?hard_response[0].altText:output_text;\n    output_text = hard_response[0].text?hard_response[0].text:output_text;\n    \n    msg.req_para.context.doActions = hard_response;\n    msg.flow_config.usedWorkspace = \"\";\n    msg.flow_config.usedWatsonName = \"\";\n    msg.payload = {\n    \t\"intents\": [],\n    \t\"entities\": [],\n    \t\"input\": {\n    \t\t\"text\": msg.talkToWatson\n    \t},\n    \t\"output\": {\n    \t\t\"text\": [output_text],\n    \t},\n    \t\"context\": msg.req_para.context\n    }\n    msg.passWatson=true;\n    return [msg,null];\n}else{\n    return [null,msg];\n}\n\nfunction hard_code_response_check(message){\n    const input_doActions_pair = {\n        //\"#YTFFTW\":[{\"type\":\"YTFF\",}],\n        //\"YTFF\":[{\"type\":\"YTFF\"}],\n        //\"ï¼ƒï¼¹ï¼´ï¼¦ï¼¦ï¼´ï¼·\":[{\"type\":\"YTFF\"}],\n        //\"ï¼¹ï¼´ï¼¦ï¼¦\":[{\"type\":\"YTFF\"}],\n        \"è¯çµ¡å°ˆå±¬å°ˆå“¡\":[{\"type\":\"special_coordinator\"}],\n        \"è¡Œå‹•å±•é–“\":[{\"text\":\"ä½ å–œæ­¡ä»€éº¼é¡å‹çš„è»Šå­å‘¢ï¼Ÿ\",\"type\":\"image_carousel\",\"altText\":\"è½è»Šã€æ€èƒŒè»Šã€æ²¹é›»è»Šã€ä¼‘æ—…è»Šã€è·‘è»Š\",\"columns\":[{\"action\":{\"text\":\"è½è»Š\",\"type\":\"message\",\"label\":\"è½è»Š\"},\"imageUrl\":\"https://s3-api.us-geo.objectstorage.softlayer.net/tytimage/LINE_images_test/car_type/car_type_1_sedan.png\"},{\"action\":{\"text\":\"æ€èƒŒè»Š\",\"type\":\"message\",\"label\":\"æ€èƒŒè»Š\"},\"imageUrl\":\"https://s3-api.us-geo.objectstorage.softlayer.net/tytimage/LINE_images_test/car_type/car_type_1_hatchback.png\"},{\"action\":{\"text\":\"æ²¹é›»è»Š\",\"type\":\"message\",\"label\":\"æ²¹é›»è»Š\"},\"imageUrl\":\"https://s3-api.us-geo.objectstorage.softlayer.net/tytimage/LINE_images_test/car_type/car_type_1_eco_friendly.png\"},{\"action\":{\"text\":\"ä¼‘æ—…è»Š\",\"type\":\"message\",\"label\":\"ä¼‘æ—…è»Š\"},\"imageUrl\":\"https://s3-api.us-geo.objectstorage.softlayer.net/tytimage/LINE_images_test/car_type/car_type_1_RV.png\"},{\"action\":{\"text\":\"è·‘è»Š\",\"type\":\"message\",\"label\":\"è·‘è»Š\"},\"imageUrl\":\"https://s3-api.us-geo.objectstorage.softlayer.net/tytimage/LINE_images_test/car_type/car_type_1_sports_car.png\"}]}],\n        //cache\n        \"Hello TOYOTAè¡Œå‹•å®¢æœ\":[{\"text\":\"ğŸ™‹HiHiï¼æ‰¾æˆ‘å˜›ï½æœ‰ä»€éº¼æˆ‘å¯ä»¥ç‚ºæ‚¨æœå‹™çš„å‘¢\",\"type\":\"carousel\",\"altText\":\"è»Šæ¬¾è³‡è¨Šã€æœå‹™è³‡è¨Šã€å“ç‰Œè³‡è¨Š\",\"columns\":[{\"text\":\"æœå‹™ç›®éŒ„\",\"actions\":[{\"text\":\"è»Šæ¬¾è³‡è¨Š\",\"type\":\"message\",\"label\":\"è»Šæ¬¾è³‡è¨Š\"},{\"text\":\"æœå‹™è³‡è¨Š\",\"type\":\"message\",\"label\":\"æœå‹™è³‡è¨Š\"},{\"text\":\"å“ç‰Œè³‡è¨Š\",\"type\":\"message\",\"label\":\"å“ç‰Œè³‡è¨Š\"}],\"imageUrl\":\"https://s3-api.us-geo.objectstorage.softlayer.net/tytimage01/LINE_images_prod/TOYOTA_LOGO.png\"}]}],\n        \"è½è»Š\":[{\"text\":\"ä½ æƒ³çŸ¥é“å“ªä¸€å°è½è»Šçš„è³‡è¨Šå‘¢ï¼Ÿ\",\"type\":\"carousel\",\"altText\":\"Altis, Altis X, Camry, Camry HYBRID, VIOS\",\"columns\":[{\"text\":\"Altis\",\"actions\":[{\"text\":\"æˆ‘æƒ³çŸ¥é“Altisçš„å”®åƒ¹\",\"type\":\"message\",\"label\":\"Altiså”®åƒ¹\"},{\"uri\":\"https://hotaicdn.azureedge.net/toyotaweb/CAR_2017092114491443673042.pdf\",\"type\":\"uri\",\"label\":\"ç·šä¸Šå‹éŒ„\"},{\"uri\":\"https://www.toyota.com.tw/testdrive.aspx#/ALTIS\",\"type\":\"uri\",\"label\":\"é ç´„è©¦ä¹˜\"}],\"imageUrl\":\"https://s3-api.us-geo.objectstorage.softlayer.net/tytimage/LINE_images_test/car_model/car_model_altis.png\"},{\"text\":\"Altis X\",\"actions\":[{\"text\":\"æˆ‘æƒ³çŸ¥é“ALTIS Xçš„å”®åƒ¹\",\"type\":\"message\",\"label\":\"ALTIS Xå”®åƒ¹\"},{\"uri\":\"https://hotaicdn.azureedge.net/toyotaweb/CAR_2017092114491443673042.pdf\",\"type\":\"uri\",\"label\":\"ç·šä¸Šå‹éŒ„\"},{\"uri\":\"https://www.toyota.com.tw/testdrive.aspx#/ALTIS\",\"type\":\"uri\",\"label\":\"é ç´„è©¦ä¹˜\"}],\"imageUrl\":\"https://s3-api.us-geo.objectstorage.softlayer.net/tytimage/LINE_images_test/car_model/car_model_altis_x.png\"},{\"text\":\"Camry\",\"actions\":[{\"text\":\"æˆ‘æƒ³çŸ¥é“CAMRYçš„å”®åƒ¹\",\"type\":\"message\",\"label\":\"CAMRYå”®åƒ¹\"},{\"uri\":\"https://hotaicdn.azureedge.net/toyotaweb/CAR_2017100613253865091513.pdf\",\"type\":\"uri\",\"label\":\"ç·šä¸Šå‹éŒ„\"},{\"uri\":\"https://www.toyota.com.tw/testdrive.aspx#/CAMRY\",\"type\":\"uri\",\"label\":\"é ç´„è©¦ä¹˜\"}],\"imageUrl\":\"https://s3-api.us-geo.objectstorage.softlayer.net/tytimage/LINE_images_test/car_model/car_model_camry.png\"},{\"text\":\"Camry HYBRID\",\"actions\":[{\"text\":\"æˆ‘æƒ³çŸ¥é“CAMRY Hybridçš„å”®åƒ¹\",\"type\":\"message\",\"label\":\"CAMRY Hybridå”®åƒ¹\"},{\"uri\":\"https://www.toyota.com.tw/download_pdf.ashx?preview=&carsty=CAMRY_HYBRID\",\"type\":\"uri\",\"label\":\"ç·šä¸Šå‹éŒ„\"},{\"uri\":\"https://www.toyota.com.tw/testdrive.aspx#/CAMRY_HYBRID\",\"type\":\"uri\",\"label\":\"é ç´„è©¦ä¹˜\"}],\"imageUrl\":\"https://s3-api.us-geo.objectstorage.softlayer.net/tytimage/LINE_images_test/car_model/car_model_camry_hybrid.png\"},{\"text\":\"VIOS\",\"actions\":[{\"text\":\"æˆ‘æƒ³çŸ¥é“VIOSçš„å”®åƒ¹\",\"type\":\"message\",\"label\":\"VIOSå”®åƒ¹\"},{\"uri\":\"https://hotaicdn.azureedge.net/toyotaweb/CAR_20180311154339F468KFB1.pdf\",\"type\":\"uri\",\"label\":\"ç·šä¸Šå‹éŒ„\"},{\"uri\":\"https://www.toyota.com.tw/testdrive.aspx#/VIOS\",\"type\":\"uri\",\"label\":\"é ç´„è©¦ä¹˜\"}],\"imageUrl\":\"https://s3-api.us-geo.objectstorage.softlayer.net/tytimage/LINE_images_test/car_model/car_model_vios.png\"}]}],\n        \"ä¼‘æ—…è»Š\":[{\"text\":\"è«‹å•æ˜¯è¦å•å“ªä¸€ç¨®ä¼‘æ—…è»Šå‘¢ï¼Ÿ\",\"type\":\"image_carousel\",\"altText\":\"é‹å‹•ä¼‘æ—…è»Š(SUV)ã€å¤šåŠŸèƒ½ä¼‘æ—…è»Š(MPV)\",\"columns\":[{\"action\":{\"text\":\"é‹å‹•ä¼‘æ—…è»Š\",\"type\":\"message\",\"label\":\"é‹å‹•ä¼‘æ—…è»Š\"},\"imageUrl\":\"https://s3-api.us-geo.objectstorage.softlayer.net/tytimage/LINE_images_test/car_type/car_type_3_SUV.png\"},{\"action\":{\"text\":\"å¤šåŠŸèƒ½ä¼‘æ—…è»Š\",\"type\":\"message\",\"label\":\"å¤šåŠŸèƒ½ä¼‘æ—…è»Š\"},\"imageUrl\":\"https://s3-api.us-geo.objectstorage.softlayer.net/tytimage/LINE_images_test/car_type/car_type_3_MPV.png\"}]}],\n        \"æ€èƒŒè»Š\":[{\"text\":\"ä½ æƒ³çŸ¥é“å“ªä¸€å°æ€èƒŒè»Šçš„è³‡è¨Šå‘¢ï¼Ÿ\",\"type\":\"carousel\",\"altText\":\"AURIS, YARIS, PRIUS c, PRIUS\",\"columns\":[{\"text\":\"AURIS\",\"actions\":[{\"text\":\"æˆ‘æƒ³çŸ¥é“AURISçš„å”®åƒ¹\",\"type\":\"message\",\"label\":\"AURISå”®åƒ¹\"},{\"uri\":\"https://hotaicdn.azureedge.net/toyotaweb/CAR_2018090816364462513858.pdf\",\"type\":\"uri\",\"label\":\"ç·šä¸Šå‹éŒ„\"},{\"uri\":\"https://www.toyota.com.tw/testdrive.aspx#/AURIS\",\"type\":\"uri\",\"label\":\"é ç´„è©¦ä¹˜\"}],\"imageUrl\":\"https://s3-api.us-geo.objectstorage.softlayer.net/tytimage/LINE_images_test/car_model/car_model_auris_v2.png\"},{\"text\":\"YARIS\",\"actions\":[{\"text\":\"æˆ‘æƒ³çŸ¥é“YARISçš„å”®åƒ¹\",\"type\":\"message\",\"label\":\"YARISå”®åƒ¹\"},{\"uri\":\"https://hotaicdn.azureedge.net/toyotaweb/CAR_2018040122382275700644.pdf\",\"type\":\"uri\",\"label\":\"ç·šä¸Šå‹éŒ„\"},{\"uri\":\"https://www.toyota.com.tw/testdrive.aspx#/YARIS\",\"type\":\"uri\",\"label\":\"é ç´„è©¦ä¹˜\"}],\"imageUrl\":\"https://s3-api.us-geo.objectstorage.softlayer.net/tytimage/LINE_images_test/car_model/car_model_yaris.png\"},{\"text\":\"PRIUS c\",\"actions\":[{\"text\":\"æˆ‘æƒ³çŸ¥é“PRIUS cçš„å”®åƒ¹\",\"type\":\"message\",\"label\":\"PRIUS cå”®åƒ¹\"},{\"uri\":\"https://hotaicdn.azureedge.net/toyotaweb/CAR_201710061335220A85AB6C.pdf\",\"type\":\"uri\",\"label\":\"ç·šä¸Šå‹éŒ„\"},{\"uri\":\"https://www.toyota.com.tw/testdrive.aspx#/PRIUS_c\",\"type\":\"uri\",\"label\":\"é ç´„è©¦ä¹˜\"}],\"imageUrl\":\"https://s3-api.us-geo.objectstorage.softlayer.net/tytimage/LINE_images_test/car_model/car_model_prius_c.png\"},{\"text\":\"PRIUS\",\"actions\":[{\"text\":\"æˆ‘æƒ³çŸ¥é“PRIUSçš„å”®åƒ¹\",\"type\":\"message\",\"label\":\"PRIUSå”®åƒ¹\"},{\"uri\":\"https://www.toyota.com.tw/download_pdf.ashx?preview=&carsty=PRIUS\",\"type\":\"uri\",\"label\":\"ç·šä¸Šå‹éŒ„\"},{\"uri\":\"https://www.toyota.com.tw/testdrive.aspx#/PRIUS\",\"type\":\"uri\",\"label\":\"é ç´„è©¦ä¹˜\"}],\"imageUrl\":\"https://s3-api.us-geo.objectstorage.softlayer.net/tytimage/LINE_images_test/car_model/car_model_prius.png\"}]}],\n        \"é‹å‹•ä¼‘æ—…è»Š\":[{\"text\":\"ä½ æƒ³çŸ¥é“å“ªä¸€å°é‹å‹•ä¼‘æ—…è»Š(SUV)çš„è³‡è¨Šå‘¢ï¼Ÿ\",\"type\":\"carousel\",\"altText\":\"ä½ æƒ³çŸ¥é“å“ªä¸€å°é‹å‹•ä¼‘æ—…è»Š(SUV)çš„è³‡è¨Šå‘¢ï¼Ÿ\",\"columns\":[{\"text\":\"RAV4\",\"actions\":[{\"text\":\"æˆ‘æƒ³çŸ¥é“RAV4çš„å”®åƒ¹\",\"type\":\"message\",\"label\":\"RAV4å”®åƒ¹\"},{\"uri\":\"https://hotaicdn.azureedge.net/toyotaweb/CAR_2017102719164858BC3D81.pdf\",\"type\":\"uri\",\"label\":\"ç·šä¸Šå‹éŒ„\"},{\"uri\":\"https://www.toyota.com.tw/testdrive.aspx#/RAV4\",\"type\":\"uri\",\"label\":\"é ç´„è©¦ä¹˜\"}],\"imageUrl\":\"https://s3-api.us-geo.objectstorage.softlayer.net/tytimage/LINE_images_test/car_model/car_model_rav4.png\"},{\"text\":\"C-HR\",\"actions\":[{\"text\":\"æˆ‘æƒ³çŸ¥é“C-HRçš„å”®åƒ¹\",\"type\":\"message\",\"label\":\"C-HRå”®åƒ¹\"},{\"uri\":\"https://www.toyota.com.tw/download_pdf.ashx?preview=&carsty=C-HR\",\"type\":\"uri\",\"label\":\"ç·šä¸Šå‹éŒ„\"},{\"uri\":\"https://www.toyota.com.tw/testdrive.aspx#/C-HR\",\"type\":\"uri\",\"label\":\"é ç´„è©¦ä¹˜\"}],\"imageUrl\":\"https://s3-api.us-geo.objectstorage.softlayer.net/tytimage/LINE_images_test/car_model/car_model_c_hr.png\"},{\"text\":\"RAV4 HYBRID\",\"actions\":[{\"text\":\"æˆ‘æƒ³çŸ¥é“RAV4 Hybridçš„å”®åƒ¹\",\"type\":\"message\",\"label\":\"RAV4 Hybridå”®åƒ¹\"},{\"uri\":\"https://hotaicdn.azureedge.net/toyotaweb/CAR_2017102719182513943774.pdf\",\"type\":\"uri\",\"label\":\"ç·šä¸Šå‹éŒ„\"},{\"uri\":\"https://www.toyota.com.tw/testdrive.aspx#/RAV4_HYBRID\",\"type\":\"uri\",\"label\":\"é ç´„è©¦ä¹˜\"}],\"imageUrl\":\"https://s3-api.us-geo.objectstorage.softlayer.net/tytimage/LINE_images_test/car_model/car_model_rav4_hybrid.png\"},{\"text\":\"PRADO\",\"actions\":[{\"text\":\"æˆ‘æƒ³çŸ¥é“PRADOçš„å”®åƒ¹\",\"type\":\"message\",\"label\":\"PRADOå”®åƒ¹\"},{\"text\":\"æˆ‘æƒ³çŸ¥é“PRADOçš„è¦æ ¼\",\"type\":\"message\",\"label\":\"PRADOè¦æ ¼\"},{\"uri\":\"https://www.toyota.com.tw/download_pdf.ashx?preview=&carsty=PRADO\",\"type\":\"uri\",\"label\":\"ç·šä¸Šå‹éŒ„\"}],\"imageUrl\":\"https://s3-api.us-geo.objectstorage.softlayer.net/tytimage/LINE_images_test/car_model/car_model_prado.png\"}]}],\n        \"è»Šæ¬¾è³‡è¨Š\":[{\"text\":\"ä½ å–œæ­¡ä»€éº¼é¡å‹çš„è»Šå­å‘¢ï¼Ÿ\",\"type\":\"image_carousel\",\"altText\":\"è½è»Šã€æ€èƒŒè»Šã€æ²¹é›»è»Šã€ä¼‘æ—…è»Šã€è·‘è»Š\",\"columns\":[{\"action\":{\"text\":\"è½è»Š\",\"type\":\"message\",\"label\":\"è½è»Š\"},\"imageUrl\":\"https://s3-api.us-geo.objectstorage.softlayer.net/tytimage/LINE_images_test/car_type/car_type_1_sedan.png\"},{\"action\":{\"text\":\"æ€èƒŒè»Š\",\"type\":\"message\",\"label\":\"æ€èƒŒè»Š\"},\"imageUrl\":\"https://s3-api.us-geo.objectstorage.softlayer.net/tytimage/LINE_images_test/car_type/car_type_1_hatchback.png\"},{\"action\":{\"text\":\"æ²¹é›»è»Š\",\"type\":\"message\",\"label\":\"æ²¹é›»è»Š\"},\"imageUrl\":\"https://s3-api.us-geo.objectstorage.softlayer.net/tytimage/LINE_images_test/car_type/car_type_1_eco_friendly.png\"},{\"action\":{\"text\":\"ä¼‘æ—…è»Š\",\"type\":\"message\",\"label\":\"ä¼‘æ—…è»Š\"},\"imageUrl\":\"https://s3-api.us-geo.objectstorage.softlayer.net/tytimage/LINE_images_test/car_type/car_type_1_RV.png\"},{\"action\":{\"text\":\"è·‘è»Š\",\"type\":\"message\",\"label\":\"è·‘è»Š\"},\"imageUrl\":\"https://s3-api.us-geo.objectstorage.softlayer.net/tytimage/LINE_images_test/car_type/car_type_1_sports_car.png\"}]}],\n        \"å¤šåŠŸèƒ½ä¼‘æ—…è»Š\":[{\"text\":\"ä½ æƒ³çŸ¥é“å“ªä¸€å°å¤šåŠŸèƒ½ä¼‘æ—…è»Š(MPV)çš„è³‡è¨Šå‘¢ï¼Ÿ\",\"type\":\"carousel\",\"altText\":\"ä½ æƒ³çŸ¥é“å“ªä¸€å°å¤šåŠŸèƒ½ä¼‘æ—…è»Š(MPV)çš„è³‡è¨Šå‘¢ï¼Ÿ\",\"columns\":[{\"text\":\"SIENTA\",\"actions\":[{\"text\":\"æˆ‘æƒ³çŸ¥é“SIENTAçš„å”®åƒ¹\",\"type\":\"message\",\"label\":\"SIENTAå”®åƒ¹\"},{\"uri\":\"https://hotaicdn.azureedge.net/toyotaweb/CAR_2018010220454111421313.pdf\",\"type\":\"uri\",\"label\":\"ç·šä¸Šå‹éŒ„\"},{\"uri\":\"https://www.toyota.com.tw/testdrive.aspx#/SIENTA\",\"type\":\"uri\",\"label\":\"é ç´„è©¦ä¹˜\"}],\"imageUrl\":\"https://s3-api.us-geo.objectstorage.softlayer.net/tytimage/LINE_images_test/car_model/car_model_sienta.png\"},{\"text\":\"PREVIA\",\"actions\":[{\"text\":\"æˆ‘æƒ³çŸ¥é“PREVIAçš„å”®åƒ¹\",\"type\":\"message\",\"label\":\"PREVIAå”®åƒ¹\"},{\"uri\":\"https://hotaicdn.azureedge.net/toyotaweb/CAR_201801171457599D426B8C.pdf\",\"type\":\"uri\",\"label\":\"ç·šä¸Šå‹éŒ„\"},{\"uri\":\"https://www.toyota.com.tw/testdrive.aspx#/PREVIA\",\"type\":\"uri\",\"label\":\"é ç´„è©¦ä¹˜\"}],\"imageUrl\":\"https://s3-api.us-geo.objectstorage.softlayer.net/tytimage/LINE_images_test/car_model/car_model_previa.png\"},{\"text\":\"SIENNA\",\"actions\":[{\"text\":\"æˆ‘æƒ³çŸ¥é“SIENNAçš„å”®åƒ¹\",\"type\":\"message\",\"label\":\"SIENNAå”®åƒ¹\"},{\"uri\":\"https://hotaicdn.azureedge.net/toyotaweb/CAR_201804131348065COBKPL2.pdf\",\"type\":\"uri\",\"label\":\"ç·šä¸Šå‹éŒ„\"},{\"uri\":\"https://www.toyota.com.tw/testdrive.aspx#/SIENNA\",\"type\":\"uri\",\"label\":\"é ç´„è©¦ä¹˜\"}],\"imageUrl\":\"https://s3-api.us-geo.objectstorage.softlayer.net/tytimage/LINE_images_test/car_model/car_model_sienna.png\"},{\"text\":\"ALPHARD\",\"actions\":[{\"text\":\"æˆ‘æƒ³çŸ¥é“ALPHARDçš„å”®åƒ¹\",\"type\":\"message\",\"label\":\"ALPHARDå”®åƒ¹\"},{\"uri\":\"https://hotaicdn.azureedge.net/toyotaweb/CAR_2018022313570200000000.pdf\",\"type\":\"uri\",\"label\":\"ç·šä¸Šå‹éŒ„\"},{\"uri\":\"https://www.toyota.com.tw/testdrive.aspx#/ALPHARD\",\"type\":\"uri\",\"label\":\"é ç´„è©¦ä¹˜\"}],\"imageUrl\":\"https://s3-api.us-geo.objectstorage.softlayer.net/tytimage/LINE_images_test/car_model/car_model_alphard.png\"},{\"text\":\"PRADO\",\"actions\":[{\"text\":\"æˆ‘æƒ³çŸ¥é“PRADOçš„å”®åƒ¹\",\"type\":\"message\",\"label\":\"PRADOå”®åƒ¹\"},{\"text\":\"æˆ‘æƒ³çŸ¥é“PRADOçš„è¦æ ¼\",\"type\":\"message\",\"label\":\"PRADOè¦æ ¼\"},{\"uri\":\"https://www.toyota.com.tw/download_pdf.ashx?preview=&carsty=PRADO\",\"type\":\"uri\",\"label\":\"ç·šä¸Šå‹éŒ„\"}],\"imageUrl\":\"https://s3-api.us-geo.objectstorage.softlayer.net/tytimage/LINE_images_test/car_model/car_model_prado.png\"}]}],\n        //cache\n        \"ç³»çµ±å»ºç½®ä¸­ï¼Œæ•¬è«‹æœŸå¾…\":[{\"type\":\"carousel\",\"altText\":\"è»Šæ¬¾è³‡è¨Šã€æœå‹™è³‡è¨Šã€å“ç‰Œè³‡è¨Š\",\"columns\":[{\"text\":\"æœå‹™ç›®éŒ„\",\"actions\":[{\"text\":\"è»Šæ¬¾è³‡è¨Š\",\"type\":\"message\",\"label\":\"è»Šæ¬¾è³‡è¨Š\"},{\"text\":\"æœå‹™è³‡è¨Š\",\"type\":\"message\",\"label\":\"æœå‹™è³‡è¨Š\"},{\"text\":\"å“ç‰Œè³‡è¨Š\",\"type\":\"message\",\"label\":\"å“ç‰Œè³‡è¨Š\"}],\"imageUrl\":\"https://s3-api.us-geo.objectstorage.softlayer.net/tytimage01/LINE_images_prod/TOYOTA_LOGO.png\"}]}],\n        \"è·‘è»Š\":[{\"text\":\"æƒ³çŸ¥é“è·‘è»Š 86 çš„ä»€éº¼è³‡è¨Šå‘¢ï¼Ÿ\",\"type\":\"carousel\",\"altText\":\"å”®åƒ¹, ç·šä¸Šå‹éŒ„, é ç´„è©¦ä¹˜\",\"columns\":[{\"text\":\"86\",\"actions\":[{\"text\":\"æˆ‘æƒ³çŸ¥é“86çš„å”®åƒ¹\",\"type\":\"message\",\"label\":\"86å”®åƒ¹\"},{\"uri\":\"https://hotaicdn.azureedge.net/toyotaweb/CAR_20171226193630O5P9DADH.pdf\",\"type\":\"uri\",\"label\":\"ç·šä¸Šå‹éŒ„\"},{\"uri\":\"https://www.toyota.com.tw/testdrive.aspx#/86\",\"type\":\"uri\",\"label\":\"é ç´„è©¦ä¹˜\"}],\"imageUrl\":\"https://s3-api.us-geo.objectstorage.softlayer.net/tytimage/LINE_images_test/car_model/car_model_86.png\"}]}],\n        \"æ’é›»å¼æ²¹é›»è¤‡åˆè»Š\":[{\"text\":\"æƒ³çŸ¥é“æ’é›»å¼æ²¹é›»è¤‡åˆè»ŠPRIUS PHVçš„ä»€éº¼è³‡è¨Šå‘¢ï¼Ÿ\",\"type\":\"carousel\",\"altText\":\"æƒ³çŸ¥é“æ’é›»å¼æ²¹é›»è¤‡åˆè»ŠPRIUS PHVçš„ä»€éº¼è³‡è¨Šå‘¢ï¼Ÿ\",\"columns\":[{\"text\":\"PRIUS PHV\",\"actions\":[{\"text\":\"æˆ‘æƒ³çŸ¥é“PRIUS PHVçš„å”®åƒ¹\",\"type\":\"message\",\"label\":\"PRIUS PHVå”®åƒ¹\"},{\"uri\":\"https://hotaicdn.azureedge.net/toyotaweb/CAR_2017063012175932071813.pdf\",\"type\":\"uri\",\"label\":\"ç·šä¸Šå‹éŒ„\"},{\"uri\":\"https://www.toyota.com.tw/testdrive.aspx#/PRIUS_PHV\",\"type\":\"uri\",\"label\":\"é ç´„è©¦ä¹˜\"}],\"imageUrl\":\"https://s3-api.us-geo.objectstorage.softlayer.net/tytimage/LINE_images_test/car_model/car_model_prius_phv.png\"}]}],\n        \"å“ç‰Œè³‡è¨Š\":[{\"type\":\"some_menu\"}],\n        \"ç¶­ä¿®ä¿é¤Š\":[{\"text\":\"æ‚¨å¥½ï¼Œå»ºè­°æ‚¨æ´½è©¢TOYOTAæœå‹™å» æˆ–é»é¸ç·šä¸Šæ–‡å­—å®¢æœï¼Œç”±å°ˆäººç‚ºæ‚¨æœå‹™ï¼Œè¬è¬\",\"type\":\"buttons\",\"actions\":[{\"uri\":\"https://www.toyota.com.tw/dealer.aspx\",\"type\":\"uri\",\"label\":\"TOYOTAæœå‹™å» \"},{\"uri\":\"https://csonline.hotaimotor.com.tw/index.php\",\"type\":\"uri\",\"label\":\"ç·šä¸Šæ–‡å­—å®¢æœ\"}],\"altText\":\"æ‚¨å¥½ï¼Œå»ºè­°æ‚¨æ´½è©¢TOYOTAæœå‹™å» æˆ–é»é¸ç·šä¸Šæ–‡å­—å®¢æœï¼Œç”±å°ˆäººç‚ºæ‚¨æœå‹™ï¼Œè¬è¬\"}]\n    }\n    return input_doActions_pair[message];\n}\n\nfunction UUID() {\n  var d = Date.now();\n  if (typeof performance !== 'undefined' && typeof performance.now === 'function'){\n    d += performance.now(); //use high-precision timer if available\n  }\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n    var r = (d + Math.random() * 16) % 16 | 0;\n    d = Math.floor(d / 16);\n      return (c === 'x' ? r : (r & 0x3 | 0x8)).toString(16);\n  });\n}\n\n",
		"outputs": 2,
		"noerr": 0,
		"x": 718.566650390625,
		"y": 695,
		"wires": [["2e2e35e.527334a"], ["36001c1f.f3e78c"]]
	}, {
		"id": "9ec72007.14fdc8",
		"type": "link out",
		"z": "92820d3d.487bc8",
		"name": "è¯ç”Ÿèªª-A for 5",
		"links": ["edf39080.fcc"],
		"x": 1213.566650390625,
		"y": 855,
		"wires": []
	}, {
		"id": "de9a28be.2efb58",
		"type": "function",
		"z": "92820d3d.487bc8",
		"name": "",
		"func": "var outputText = msg.payload.output.text.join(\"\").replace(/\\n/g,\"\");\n\nif(msg.payload.context.doActions!=null && msg.payload.context.doActions.length>0){\n   msg.watson_doActions = msg.payload.context.doActions ;\n}else if(exist_str_btn(outputText)){\n    msg.watson_doActions = combine_btn(outputText);\n}else{\n    msg.watson_doActions = [{\n        \"type\": \"text\",\n        \"text\": outputText\n    }];\n}\n\nreturn msg;\n\nfunction exist_str_btn(text){\n    \n    if(text && text.split(\"1.\").length>1){\n        if(!text.split(\"1.\")[1].startsWith(\"pdf\")){\n            return true;\n        }\n    }\n    return false;\n}\n\nfunction combine_btn(text){\n    \n    let buttonTitle = \"\";\n    let buttonAssign=[];\n    buttonTitle = text.split(\"1.\")[0];\n    buttonTitle = buttonTitle==\"\"?\"ã€€\":buttonTitle;\n\n    for(var i=1;i<10;i++){\n        if(text.split(i+\".\").length>1){\n            let fetchStr = text\n            \t\t    .split(i+\".\")[1]\n            \t\t    .split((i+1)+\".\")[0];\n            buttonAssign.push(fetchStr.trim());\n        }\n    }\n    \n    return [{\n        buttonTitle : buttonTitle,\n        buttonAssign : buttonAssign,\n        type : \"my_btns\"\n    }]\n}\n\n",
		"outputs": 1,
		"noerr": 0,
		"x": 1108.566650390625,
		"y": 855,
		"wires": [["9ec72007.14fdc8"]]
	}, {
		"id": "7456d913.ac2d58",
		"type": "function",
		"z": "92820d3d.487bc8",
		"name": "",
		"func": "\nif(msg.payload.output.error!=null){\n    let timestamp = Date.now();\n    msg.payload.type = \"watson_says\";\n    msg.payload.error = msg.payload.output.error;\n    msg.payload.timestamp=timestamp;\n    msg.payload.time = new Date(new Date(timestamp).getTime()+8*3600*1000).toISOString().replace(\"T\",\" \").split(\".\")[0];\n    node.status({fill:\"red\",shape:\"dot\",text:msg.payload.error});\n    return [msg,{\n        payload:{\n            error_type:\"watson_says\",\n            error:msg.payload.error\n        }\n    }];\n}",
		"outputs": 2,
		"noerr": 0,
		"x": 1108.566650390625,
		"y": 895,
		"wires": [["f800fea3.4766e8"], ["a40724ae.1c7f28"]]
	}, {
		"id": "f800fea3.4766e8",
		"type": "ibmiot out",
		"z": "92820d3d.487bc8",
		"authentication": "boundService",
		"apiKey": "",
		"outputType": "evt",
		"deviceId": "TaipeiDigital",
		"deviceType": "robot",
		"eventCommandType": "SaveCloudantError",
		"format": "json",
		"data": "msg.payload",
		"qos": 0,
		"name": "Error",
		"service": "registered",
		"x": 1248.566650390625,
		"y": 895,
		"wires": []
	}, {
		"id": "dc0daa6.1f40858",
		"type": "ibmiot out",
		"z": "92820d3d.487bc8",
		"authentication": "boundService",
		"apiKey": "",
		"outputType": "evt",
		"deviceId": "TaipeiDigital",
		"deviceType": "robot",
		"eventCommandType": "SaveCloudantLog",
		"format": "json",
		"data": "msg.payload",
		"qos": 0,
		"name": "Log",
		"service": "registered",
		"x": 1188.566650390625,
		"y": 495,
		"wires": []
	}, {
		"id": "c2e992c9.184ca",
		"type": "ibmiot out",
		"z": "92820d3d.487bc8",
		"authentication": "boundService",
		"apiKey": "",
		"outputType": "evt",
		"deviceId": "TaipeiDigital",
		"deviceType": "robot",
		"eventCommandType": "SaveCloudantLog",
		"format": "json",
		"data": "msg.payload",
		"qos": 0,
		"name": "Log",
		"service": "registered",
		"x": 1628.566650390625,
		"y": 355,
		"wires": []
	}, {
		"id": "6b6a8751.6a768",
		"type": "function",
		"z": "92820d3d.487bc8",
		"name": "",
		"func": "let timestamp = Date.now();\nmsg.flow_config.time_record.response_time = timestamp;\n\nreturn {\n    payload:Object.assign(\n        msg.flow_config.time_record,\n        {\n            input: msg.req_para.message,\n            output: msg.payload,\n            timestamp:timestamp,\n            time : new Date(timestamp+8*3600*1000).toISOString().replace(\"T\",\" \").split(\".\")[0],\n        }\n    )\n};",
		"outputs": 1,
		"noerr": 0,
		"x": 1288.566650390625,
		"y": 455,
		"wires": [["2e402ea.eb304d2"]]
	}, {
		"id": "c151879.ccea678",
		"type": "function",
		"z": "92820d3d.487bc8",
		"name": "",
		"func": "let timestamp = Date.now();\nmsg.flow_config.time_record.response_time = timestamp;\n\nreturn {\n    payload:Object.assign(\n        msg.flow_config.time_record,\n        {\n            input: msg.req_para.message,\n            output: msg.payload,\n            timestamp:timestamp,\n            time : new Date(timestamp+8*3600*1000).toISOString().replace(\"T\",\" \").split(\".\")[0],\n        }\n    )\n};",
		"outputs": 1,
		"noerr": 0,
		"x": 1048.566650390625,
		"y": 475,
		"wires": [["dc0daa6.1f40858"]]
	}, {
		"id": "5a0fc45.378e23c",
		"type": "ibmiot out",
		"z": "92820d3d.487bc8",
		"authentication": "boundService",
		"apiKey": "",
		"outputType": "evt",
		"deviceId": "TaipeiDigital",
		"deviceType": "robot",
		"eventCommandType": "SaveCloudantError",
		"format": "json",
		"data": "msg.payload",
		"qos": 0,
		"name": "Error",
		"service": "registered",
		"x": 648.566650390625,
		"y": 95,
		"wires": []
	}, {
		"id": "be2a8208.cae518",
		"type": "debug",
		"z": "92820d3d.487bc8",
		"name": "DoActions",
		"active": false,
		"tosidebar": true,
		"console": false,
		"tostatus": false,
		"complete": "assistant_says.context.doActions",
		"x": 1118.566650390625,
		"y": 795,
		"wires": []
	}, {
		"id": "960e42ce.fb19e8",
		"type": "ibmiot out",
		"z": "92820d3d.487bc8",
		"authentication": "boundService",
		"apiKey": "",
		"outputType": "evt",
		"deviceId": "TaipeiDigital",
		"deviceType": "robot",
		"eventCommandType": "SendErrorMail",
		"format": "json",
		"data": "msg.payload",
		"qos": 0,
		"name": "SendErrorMail",
		"service": "registered",
		"x": 958.566650390625,
		"y": 1015,
		"wires": []
	}, {
		"id": "d1d35fd4.26c8d8",
		"type": "ibmiot out",
		"z": "92820d3d.487bc8",
		"authentication": "boundService",
		"apiKey": "",
		"outputType": "evt",
		"deviceId": "TaipeiDigital",
		"deviceType": "robot",
		"eventCommandType": "SendErrorMail",
		"format": "json",
		"data": "msg.payload",
		"qos": 0,
		"name": "SendErrorMail",
		"service": "registered",
		"x": 678.566650390625,
		"y": 175,
		"wires": []
	}, {
		"id": "a40724ae.1c7f28",
		"type": "ibmiot out",
		"z": "92820d3d.487bc8",
		"authentication": "boundService",
		"apiKey": "",
		"outputType": "evt",
		"deviceId": "TaipeiDigital",
		"deviceType": "robot",
		"eventCommandType": "SendErrorMail",
		"format": "json",
		"data": "msg.payload",
		"qos": 0,
		"name": "SendErrorMail",
		"service": "registered",
		"x": 1278.566650390625,
		"y": 935,
		"wires": []
	}, {
		"id": "9e578843.045aa8",
		"type": "ibmiot out",
		"z": "92820d3d.487bc8",
		"authentication": "boundService",
		"apiKey": "",
		"outputType": "evt",
		"deviceId": "TaipeiDigital",
		"deviceType": "robot",
		"eventCommandType": "SaveCloudantError",
		"format": "json",
		"data": "msg.payload",
		"qos": 0,
		"name": "Error",
		"service": "registered",
		"x": 928.566650390625,
		"y": 975,
		"wires": []
	}, {
		"id": "615342af.4734ac",
		"type": "debug",
		"z": "92820d3d.487bc8",
		"name": "DoActions",
		"active": true,
		"tosidebar": true,
		"console": false,
		"tostatus": false,
		"complete": "true",
		"x": 958.566650390625,
		"y": 1055,
		"wires": []
	}, {
		"id": "6437607d.b67d58",
		"type": "debug",
		"z": "92820d3d.487bc8",
		"name": "AssistantOut",
		"active": false,
		"tosidebar": true,
		"console": false,
		"tostatus": false,
		"complete": "true",
		"x": 978.566650390625,
		"y": 695,
		"wires": []
	}, {
		"id": "ab31ca9d.44487",
		"type": "debug",
		"z": "92820d3d.487bc8",
		"name": "DEBUG",
		"active": false,
		"tosidebar": true,
		"console": false,
		"tostatus": false,
		"complete": "true",
		"x": 1298.566650390625,
		"y": 214,
		"wires": []
	}, {
		"id": "8529b27a.9f9a18",
		"type": "function",
		"z": "92820d3d.487bc8",
		"name": "",
		"func": "\nmsg.url = msg.flow_config.HT_API_host+\"LINE006_Q00\";\nmsg.headers = {\n    \"Content-Type\":\"application/x-www-form-urlencoded\"\n}\n\nmsg.payload = {\n    \"jsonstr\":JSON.stringify({\n        \"ENCYID\": msg.req_para.replyId,\n        \"FRAN\": \"L\"\n    })\n};\n\nreturn msg;\n\n",
		"outputs": 1,
		"noerr": 0,
		"x": 448.566650390625,
		"y": 1535,
		"wires": [["8006123a.042f4"]]
	}, {
		"id": "2b9caecc.b7006a",
		"type": "function",
		"z": "92820d3d.487bc8",
		"name": "",
		"func": "/*msg.payload = {\n    \"rtnCode\": \"0\",\n    \"rtnMsg\": \"\",\n    \"CSINFO\": [\n        {\n            \"LICSNO\": \"RBD-0021\",\n            \"FRAN\": \"L\",\n            \"CARNM\": \"IS300h\",\n            \"CRCOMPID\": \"AA\",\n            \"CRSALR\": \"AA94453\",\n            \"CRSALRNM\": \"æ¥Šå»ºä¸­\",\n            \"SRCOMPID\": \"AA\",\n            \"WHSRVNO\": \"AA94453\",\n            \"WHSRVNM\": \"åŠ‰ä¼¯æº«\",\n            \"NICKNAME\": \"æŸå»·\",\n            \"PICURL\": \"https://profile.line-scdn.net/0huWZ840ahKnhnQQYLIUFVL1sEJBUQbywwH3IyGhJFJ0FMeGp5Wi9hSkBEI00ad256CCIyGEQVJhpL\"\n        }\n    ]\n}*/\n\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 668.566650390625,
		"y": 1535,
		"wires": [["e45d043d.c858d"]]
	}, {
		"id": "e45d043d.c858d",
		"type": "function",
		"z": "92820d3d.487bc8",
		"name": "",
		"func": "let one_on_one_host = msg.flow_config.one_on_one_host;\nlet target =  msg.target;\n\nlet sales_id_b64 = new Buffer(msg.payload.CSINFO[0].CRSALR).toString('base64');\nlet sales_name = msg.payload.CSINFO[0].CRSALRNM;\nlet service_id_b64 = new Buffer(msg.payload.CSINFO[0].WHSRVNO).toString('base64');\nlet service_name = msg.payload.CSINFO[0].WHSRVNM;\nlet cust_id_b64 = new Buffer(msg.req_para.replyId).toString('base64');\n\nlet sales_url = one_on_one_host+\"cust.do?c=\"+cust_id_b64+\"&s=\"+sales_id_b64;\nlet services_url = one_on_one_host+\"cust.do?c=\"+cust_id_b64+\"&s=\"+service_id_b64;\n\nlet messageTemplate=\n{\n\t\"to\": target,\n\t\"messages\": [{\n    \t\"type\":\"text\",\n    \t\"text\":\"æ‚¨å¥½ï¼Œå¯ä»¥é¸æ“‡éœ€è¦å°è«‡ä¹‹ 'éŠ·å”®å°ˆå“¡' æˆ– 'æœå‹™å°ˆå“¡'ï¼Œ Lexuså°‡ç‚ºæ‚¨ä»‹ç´¹æ‚¨çš„å°ˆå±¬å°ˆå“¡\"\n    },{\n    \t\"type\": \"template\",\n    \t\"altText\": \"æ­¡è¿é¸æ“‡æ‚¨éœ€è¦çš„å°ˆå“¡\",\n    \t\"template\": {\n    \t\t\"type\": \"carousel\",\n    \t\t\"imageAspectRatio\": \"rectangle\",\n    \t\t\"imageSize\": \"cover\",\n    \t\t\"columns\": [{\n    \t\t\t\t\"text\": \"æ­¡è¿é»é¸æ‚¨éœ€è¦çš„æ¥­å‹™é¡åˆ¥ï¼Œè‹¥ä»–å› å…¬å‹™ç¹å¿™ï¼Œè«‹ç¨ç­‰ä¸€ä¸‹å–”\\nä¸Šç­æ™‚é–“ï¼š09:00-19:00\",\n    \t\t\t\t\"actions\": [{\n    \t\t\t\t\t\t\"uri\": sales_url,\n    \t\t\t\t\t\t\"type\": \"uri\",\n    \t\t\t\t\t\t\"label\": \"éŠ·å”®å°ˆå“¡-\"+sales_name\n    \t\t\t\t\t},{\n    \t\t\t\t\t\t\"uri\": services_url,\n    \t\t\t\t\t\t\"type\": \"uri\",\n    \t\t\t\t\t\t\"label\": \"æœå‹™å°ˆå“¡-\"+service_name\n    \t\t\t\t\t}\n    \t\t\t\t],\n    \t\t\t\t\"thumbnailImageUrl\": \"https://cdn2.ettoday.net/images/736/d736983.jpg\"\n    \t\t\t}\n    \t\t]\n    \t}\n    }]\n};\n\nmsg.retMsg = messageTemplate;\n\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 848.566650390625,
		"y": 1535,
		"wires": [["8438b525.1e6c88"]]
	}, {
		"id": "8006123a.042f4",
		"type": "http request",
		"z": "92820d3d.487bc8",
		"name": "",
		"method": "POST",
		"ret": "obj",
		"url": "",
		"tls": "",
		"x": 608.566650390625,
		"y": 1535,
		"wires": [["2b9caecc.b7006a"]]
	}, {
		"id": "7d18a763.7437c8",
		"type": "http in",
		"z": "92820d3d.487bc8",
		"name": "",
		"url": "/servicebot_conversation_1",
		"method": "post",
		"upload": false,
		"swaggerDoc": "",
		"x": 338.566650390625,
		"y": 335,
		"wires": [["b672a78c.cb5848", "925a6aa6.de0728"]]
	}, {
		"id": "d976d502.688fd8",
		"type": "function",
		"z": "92820d3d.487bc8",
		"name": "",
		"func": "msg.payload = {\n\t\"to\": msg.payload.replyId,\n\t\"messages\": [{\n\t\t\t\"type\": \"text\",\n\t\t\t\"text\": \"ç³»çµ±QAé–‹ç™¼ä¸­ï¼Œè«‹è€å¿ƒç­‰å€™ç³»çµ±å®Œæˆã€‚\"\n\t\t}\n\t],\n\t\"context\": null\n}\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 548.566650390625,
		"y": 455,
		"wires": [["ed892581.0104e"]]
	}, {
		"id": "ed892581.0104e",
		"type": "http response",
		"z": "92820d3d.487bc8",
		"name": "",
		"statusCode": "200",
		"headers": {},
		"x": 706.566650390625,
		"y": 455,
		"wires": []
	}, {
		"id": "94660744.511e2",
		"type": "ibmiot in",
		"z": "952c8d23.7f0d4",
		"authentication": "boundService",
		"apiKey": "",
		"inputType": "evt",
		"logicalInterface": "",
		"ruleId": "",
		"deviceId": "TaipeiDigital",
		"applicationId": "",
		"deviceType": "robot",
		"eventType": "SaveCloudantLog",
		"commandType": "",
		"format": "json",
		"name": "IBM IoT",
		"service": "registered",
		"allDevices": "",
		"allApplications": "",
		"allDeviceTypes": false,
		"allLogicalInterfaces": "",
		"allEvents": false,
		"allCommands": "",
		"allFormats": "",
		"qos": 0,
		"x": 432.566650390625,
		"y": 170.56666564941406,
		"wires": [["bdddaf0d.d5c368"]]
	}, {
		"id": "e6e9d772.0a36f",
		"type": "ibmiot in",
		"z": "952c8d23.7f0d4",
		"authentication": "boundService",
		"apiKey": "",
		"inputType": "evt",
		"logicalInterface": "",
		"ruleId": "",
		"deviceId": "TaipeiDigital",
		"applicationId": "",
		"deviceType": "robot",
		"eventType": "SaveCloudantError",
		"commandType": "",
		"format": "json",
		"name": "IBM IoT",
		"service": "registered",
		"allDevices": "",
		"allApplications": "",
		"allDeviceTypes": false,
		"allLogicalInterfaces": "",
		"allEvents": false,
		"allCommands": "",
		"allFormats": "",
		"qos": 0,
		"x": 432.566650390625,
		"y": 230.56666564941406,
		"wires": [["c41d8d5a.d70d3"]]
	}, {
		"id": "efeaba4e.0379f8",
		"type": "ibmiot in",
		"z": "952c8d23.7f0d4",
		"authentication": "boundService",
		"apiKey": "",
		"inputType": "evt",
		"logicalInterface": "",
		"ruleId": "",
		"deviceId": "TaipeiDigital",
		"applicationId": "",
		"deviceType": "robot",
		"eventType": "SendMail",
		"commandType": "",
		"format": "json",
		"name": "IBM IoT",
		"service": "registered",
		"allDevices": "",
		"allApplications": "",
		"allDeviceTypes": false,
		"allLogicalInterfaces": "",
		"allEvents": false,
		"allCommands": "",
		"allFormats": "",
		"qos": 0,
		"x": 432.566650390625,
		"y": 290.56666564941406,
		"wires": [["8347d911.b9c55", "2608d09d.de6838"]]
	}, {
		"id": "ccec8a65.6e972",
		"type": "cloudant out",
		"z": "952c8d23.7f0d4",
		"name": "",
		"cloudant": "61dca38d.78e234",
		"database": "lineapi_log",
		"service": "nodeRed-API-Lexus-test-cloudantNoSQLDB",
		"payonly": true,
		"operation": "insert",
		"x": 742.566650390625,
		"y": 170.56666564941406,
		"wires": []
	}, {
		"id": "53b08eb6.df621",
		"type": "cloudant out",
		"z": "952c8d23.7f0d4",
		"name": "",
		"cloudant": "61dca38d.78e234",
		"database": "lineapi_error",
		"service": "nodeRed-API-Lexus-test-cloudantNoSQLDB",
		"payonly": true,
		"operation": "insert",
		"x": 752.566650390625,
		"y": 230.56666564941406,
		"wires": []
	}, {
		"id": "bb370e4b.7642",
		"type": "e-mail",
		"z": "952c8d23.7f0d4",
		"server": "smtp.gmail.com",
		"port": "465",
		"secure": true,
		"name": "",
		"dname": "",
		"x": 822.566650390625,
		"y": 290.56666564941406,
		"wires": []
	}, {
		"id": "8347d911.b9c55",
		"type": "function",
		"z": "952c8d23.7f0d4",
		"name": "contextæ ¼å¼æª¢æŸ¥",
		"func": "\nif(msg.payload!=null && msg.payload.context!=null && typeof msg.payload.context!=\"object\"){\n    let type = \"éè¦ç¯„æ ¼å¼\";\n    type = typeof msg.payload.context==\"string\"?\"å­—ä¸²\":type;\n    type = typeof msg.payload.context==\"number\"?\"æ•¸å­—\":type;\n    msg.payload=\"<font style='font-family: \\\"Microsoft JhengHei\\\";'>\"+\n                \"<b style='font-size:1.2em;'>éŒ¯èª¤åŸå› </b>ï¼š<br>ã€€LINEBOTä¸æ¥å—contextæ ¼å¼ç‚º '\"+type+\"' ä¹‹è«‹æ±‚ã€‚<br><br>\"+\n                \"<b style='font-size:1.2em;'>ç™¼ç”Ÿæ™‚é–“</b>ï¼š<br>ã€€\"+new Date(Date.now()+8*3600*1000).toISOString().replace(\"T\",\" \").split(\".\")[0]+\"ã€‚<br><br>\"+\n                \"<b style='font-size:1.2em;'>éŒ¯èª¤APIè«‹æ±‚å¦‚ä¸‹</b>ï¼š<br>\"+JSON.stringify(msg.payload, null, 4).replace(/    /g,\"ã€€ã€€ã€€\").replace(/\\n/g,\"<br>\")+\"</font>\";\n    \n    msg.topic=\"LINEBOTç’°å¢ƒæ”¶åˆ°éŒ¯èª¤APIè«‹æ±‚\";\n    msg.cc=\"benchen@pershing.com.tw\";\n    msg.to=\"GRACECHIU@mail.hotaimotor.com.tw\";\n    return msg;\n}\n",
		"outputs": 1,
		"noerr": 0,
		"x": 632.566650390625,
		"y": 290.56666564941406,
		"wires": [[]]
	}, {
		"id": "eb7e8dc8.eb7af",
		"type": "function",
		"z": "952c8d23.7f0d4",
		"name": "Mail Test",
		"func": "//ptenzyqxqobotpsc\nmsg = {\n    payload:{\n        context:\"\",\n        type:\"text\",\n        message:\"å¦³å¥½\"\n    }\n}\nif(msg.payload!=null && msg.payload.context!=null && typeof msg.payload.context!=\"object\"){\n    let type = \"éè¦ç¯„æ ¼å¼\";\n    type = typeof msg.payload.context==\"string\"?\"å­—ä¸²\":type;\n    type = typeof msg.payload.context==\"number\"?\"æ•¸å­—\":type;\n    msg.payload=\"<font style='font-family: \\\"Microsoft JhengHei\\\";'>\"+\n                \"<b style='font-size:1.2em;'>éŒ¯èª¤åŸå› </b>ï¼š<br>ã€€LINEBOTä¸æ¥å—contextæ ¼å¼ç‚º '\"+type+\"' ä¹‹è«‹æ±‚ã€‚<br><br>\"+\n                \"<b style='font-size:1.2em;'>ç™¼ç”Ÿæ™‚é–“</b>ï¼š<br>ã€€\"+new Date(Date.now()+8*3600*1000).toISOString().replace(\"T\",\" \").split(\".\")[0]+\"ã€‚<br><br>\"+\n                \"<b style='font-size:1.2em;'>éŒ¯èª¤APIè«‹æ±‚å¦‚ä¸‹</b>ï¼š<br>\"+JSON.stringify(msg.payload, null, 4).replace(/    /g,\"ã€€ã€€ã€€\").replace(/\\n/g,\"<br>\")+\"</font>\";\n    \n    msg.topic=\"ç™¼ä¿¡æ¸¬è©¦\";\n    msg.to=\"benchen@pershing.com.tw\";\n    msg.cc=\"g4ru04@gmail.com\";\n    return msg;\n}\n",
		"outputs": 1,
		"noerr": 0,
		"x": 612.566650390625,
		"y": 370.56666564941406,
		"wires": [["dd8bfe5c.8b3f98"]]
	}, {
		"id": "dd8bfe5c.8b3f98",
		"type": "e-mail",
		"z": "952c8d23.7f0d4",
		"server": "smtp.gmail.com",
		"port": "465",
		"secure": true,
		"name": "",
		"dname": "",
		"x": 832.566650390625,
		"y": 370.56666564941406,
		"wires": []
	}, {
		"id": "ce937896.1eb3f8",
		"type": "inject",
		"z": "952c8d23.7f0d4",
		"name": "",
		"topic": "",
		"payload": "",
		"payloadType": "date",
		"repeat": "",
		"crontab": "",
		"once": false,
		"onceDelay": 0.1,
		"x": 432.566650390625,
		"y": 370.56666564941406,
		"wires": [["eb7e8dc8.eb7af"]]
	}, {
		"id": "2608d09d.de6838",
		"type": "function",
		"z": "952c8d23.7f0d4",
		"name": "contextæ ¼å¼æª¢æŸ¥-Ben",
		"func": "\nif(msg.payload!=null && msg.payload.context!=null && typeof msg.payload.context!=\"object\"){\n    let type = \"éè¦ç¯„æ ¼å¼\";\n    type = typeof msg.payload.context==\"string\"?\"å­—ä¸²\":type;\n    type = typeof msg.payload.context==\"number\"?\"æ•¸å­—\":type;\n    msg.payload=\"<font style='font-family: \\\"Microsoft JhengHei\\\";'>\"+\n                \"<b style='font-size:1.2em;'>éŒ¯èª¤åŸå› </b>ï¼š<br>ã€€LINEBOTä¸æ¥å—contextæ ¼å¼ç‚º '\"+type+\"' ä¹‹è«‹æ±‚ã€‚<br><br>\"+\n                \"<b style='font-size:1.2em;'>ç™¼ç”Ÿæ™‚é–“</b>ï¼š<br>ã€€\"+new Date(Date.now()+8*3600*1000).toISOString().replace(\"T\",\" \").split(\".\")[0]+\"ã€‚<br><br>\"+\n                \"<b style='font-size:1.2em;'>éŒ¯èª¤APIè«‹æ±‚å¦‚ä¸‹</b>ï¼š<br>\"+JSON.stringify(msg.payload, null, 4).replace(/    /g,\"ã€€ã€€ã€€\").replace(/\\n/g,\"<br>\")+\"</font>\";\n    \n    msg.topic=\"LINEBOTç’°å¢ƒæ”¶åˆ°éŒ¯èª¤APIè«‹æ±‚\";\n    msg.to=\"benchen@pershing.com.tw\";\n    return msg;\n}\n",
		"outputs": 1,
		"noerr": 0,
		"x": 632.566650390625,
		"y": 330.56666564941406,
		"wires": [["bb370e4b.7642"]]
	}, {
		"id": "bdddaf0d.d5c368",
		"type": "function",
		"z": "952c8d23.7f0d4",
		"name": "",
		"func": "node.status({fill:\"green\",shape:\"dot\",text:new Date(Date.now()+8*3600*1000).toISOString().replace(\"T\",\" \").split(\".\")[0]});\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 582.566650390625,
		"y": 170.56666564941406,
		"wires": [["ccec8a65.6e972"]]
	}, {
		"id": "c41d8d5a.d70d3",
		"type": "function",
		"z": "952c8d23.7f0d4",
		"name": "",
		"func": "node.status({fill:\"green\",shape:\"dot\",text:new Date(Date.now()+8*3600*1000).toISOString().replace(\"T\",\" \").split(\".\")[0]});\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 582.566650390625,
		"y": 230.56666564941406,
		"wires": [["53b08eb6.df621"]]
	}, {
		"id": "8a15d1a8.048f88",
		"type": "ibmiot in",
		"z": "952c8d23.7f0d4",
		"authentication": "boundService",
		"apiKey": "",
		"inputType": "evt",
		"logicalInterface": "",
		"ruleId": "",
		"deviceId": "TaipeiDigital",
		"applicationId": "",
		"deviceType": "robot",
		"eventType": "SendErrorMail",
		"commandType": "",
		"format": "json",
		"name": "IBM IoT",
		"service": "registered",
		"allDevices": "",
		"allApplications": "",
		"allDeviceTypes": false,
		"allLogicalInterfaces": "",
		"allEvents": false,
		"allCommands": "",
		"allFormats": "",
		"qos": 0,
		"x": 432.566650390625,
		"y": 530.5666656494141,
		"wires": [["7ba63075.1d0578", "50b44468.5f2f1c"]]
	}, {
		"id": "308871f2.d87a76",
		"type": "e-mail",
		"z": "952c8d23.7f0d4",
		"server": "smtp.gmail.com",
		"port": "465",
		"secure": true,
		"name": "",
		"dname": "",
		"x": 762.566650390625,
		"y": 530.5666656494141,
		"wires": []
	}, {
		"id": "7ba63075.1d0578",
		"type": "function",
		"z": "952c8d23.7f0d4",
		"name": "éŒ¯èª¤ç™¼ä¿¡",
		"func": "\nmsg.payload.error=msg.payload.error!=null?msg.payload.error:\"\";\nlet mail_msg = {\n    cc:\"g4ru04@gmail.com\",\n    topic: \"å’Œæ³°LINEæ¸¬è©¦ç’°å¢ƒéŒ¯èª¤\",\n    to: \"benchen@pershing.com.tw\",\n    payload: (\n        \"<font style='font-family: \\\"Microsoft JhengHei\\\";'>\"+\n        \"<b style='font-size:1.2em;'>éŒ¯èª¤é¡å‹</b>ï¼š<br>ã€€\"+\n        msg.payload.error_type + \"<br><br>\"+\n        \"<b style='font-size:1.2em;'>ç™¼ç”Ÿæ™‚é–“</b>ï¼š<br>ã€€\"+\n        new Date(Date.now()+8*3600*1000).toISOString().replace(\"T\",\" \").split(\".\")[0]+\"ã€‚<br><br>\"+\n        \"<b style='font-size:1.2em;'>éŒ¯èª¤å¦‚ä¸‹</b>ï¼š<br>\"+\n        JSON.stringify(msg.payload.error, null, 4).replace(/    /g,\"ã€€ã€€ã€€\").replace(/\\n/g,\"<br>\")+\n        \"</font>\"\n    )\n}\n\nnode.status({fill:\"red\",shape:\"dot\",text:new Date(Date.now()+8*3600*1000).toISOString().replace(\"T\",\" \").split(\".\")[0]});\nreturn mail_msg ;",
		"outputs": 1,
		"noerr": 0,
		"x": 592.566650390625,
		"y": 530.5666656494141,
		"wires": [["308871f2.d87a76"]]
	}, {
		"id": "50b44468.5f2f1c",
		"type": "debug",
		"z": "952c8d23.7f0d4",
		"name": "",
		"active": true,
		"tosidebar": true,
		"console": false,
		"tostatus": false,
		"complete": "false",
		"x": 592.566650390625,
		"y": 590.5666656494141,
		"wires": []
	}
]
