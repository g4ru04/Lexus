[{
		"id": "f0cf7ead.f9a0a8",
		"type": "debug",
		"z": "da8f7bde.d2b408",
		"name": "MSG IN",
		"active": false,
		"tosidebar": true,
		"console": false,
		"tostatus": false,
		"complete": "true",
		"x": 763.3332824707031,
		"y": 340.33331298828125,
		"wires": []
	}, {
		"id": "c659ec27.994278",
		"type": "socketio-in",
		"z": "da8f7bde.d2b408",
		"name": "",
		"server": "d5c1b5fd.4dfad8",
		"rules": [{
				"v": "message"
			}, {
				"v": "enter"
			}, {
				"v": "leave"
			}
		],
		"x": 158.33331298828125,
		"y": 406.3333282470703,
		"wires": [["87f13c2a.920eb8"]]
	}, {
		"id": "d764afe7.de0d98",
		"type": "switch",
		"z": "da8f7bde.d2b408",
		"name": "checkEvent",
		"property": "socketIOEvent",
		"propertyType": "msg",
		"rules": [{
				"t": "eq",
				"v": "message",
				"vt": "str"
			}, {
				"t": "eq",
				"v": "enter",
				"vt": "str"
			}, {
				"t": "eq",
				"v": "leave",
				"vt": "str"
			}, {
				"t": "eq",
				"v": "disconnect",
				"vt": "str"
			}, {
				"t": "eq",
				"v": "disconnecting",
				"vt": "str"
			}, {
				"t": "eq",
				"v": "newListener",
				"vt": "str"
			}, {
				"t": "eq",
				"v": "typing",
				"vt": "str"
			}, {
				"t": "eq",
				"v": "stop typing",
				"vt": "str"
			}
		],
		"checkall": "false",
		"repair": false,
		"outputs": 8,
		"x": 770.3332824707031,
		"y": 466.3332977294922,
		"wires": [["811411b9.d1e678"], ["158e7869.f375a8"], ["6f348e91.0f8e98"], ["6f348e91.0f8e98"], [], [], [], []]
	}, {
		"id": "ffd27283.5745f8",
		"type": "function",
		"z": "da8f7bde.d2b408",
		"name": "new message",
		"func": "/*msg.payload = {\n username: msg.socketIOStaticProperties.room,\n message: msg.payload\n};*/\n//RED.util.setMessageProperty(msg, \"socketIOEmit\", \"broadcast.emit\", true);\n\nmsg.payload = msg.payload_preserved;\nRED.util.setMessageProperty(msg, \"socketIOEmit\", \"room\", true);\nif(msg.socketIOStaticProperties==null){\n    node.warn(\"Room id 不見了!\");\n}\n\nmsg.room = msg.socketIOStaticProperties.room;\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 1226.3336181640625,
		"y": 706.3333435058594,
		"wires": [["bacab9aa.9e48b8", "55c71071.a9475"]]
	}, {
		"id": "530c0694.2cb448",
		"type": "debug",
		"z": "da8f7bde.d2b408",
		"name": "EVENT",
		"active": true,
		"tosidebar": true,
		"console": false,
		"tostatus": false,
		"complete": "socketIOEvent",
		"x": 757.0832824707031,
		"y": 384.08331298828125,
		"wires": []
	}, {
		"id": "ac5f8440.ef12b",
		"type": "catch",
		"z": "da8f7bde.d2b408",
		"name": "",
		"scope": null,
		"x": 240.69996643066406,
		"y": 246.8333740234375,
		"wires": [["f1e283da.230ae8"]]
	}, {
		"id": "f1e283da.230ae8",
		"type": "debug",
		"z": "da8f7bde.d2b408",
		"name": "ERROR",
		"active": true,
		"tosidebar": true,
		"console": false,
		"tostatus": false,
		"complete": "true",
		"x": 454.69996643066406,
		"y": 281.5833740234375,
		"wires": []
	}, {
		"id": "25998a28.5db1d6",
		"type": "function",
		"z": "da8f7bde.d2b408",
		"name": "",
		"func": "//node.warn(msg.socketIOEvent+ \" ## \"+JSON.stringify(msg.payload));\n\nif([\"newListener\",\"disconnecting\"].indexOf(msg.socketIOEvent)==-1){\n    return msg;\n}\n\n\n",
		"outputs": 1,
		"noerr": 0,
		"x": 595.699951171875,
		"y": 466.3333282470703,
		"wires": [["d764afe7.de0d98", "f0cf7ead.f9a0a8", "530c0694.2cb448"]]
	}, {
		"id": "158e7869.f375a8",
		"type": "function",
		"z": "da8f7bde.d2b408",
		"name": "enter room",
		"func": "RED.util.setMessageProperty(\n    msg, \"socketIOAddStaticProperties\", \n    {\n        room:msg.payload\n    }, true);\n\nRED.util.setMessageProperty(\n    msg, \"socketIOEmit\", \"emit\", true);\n\nmsg.payload = {\n    room: msg.payload\n};\n\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 953.0833129882812,
		"y": 446.08326721191406,
		"wires": [["bc0353dc.7d5838", "cc3d78e6.2eb7f8", "c1ac7b2d.b8cfe", "46a3e44a.9d180c"]]
	}, {
		"id": "bc0353dc.7d5838",
		"type": "socketio-join",
		"z": "da8f7bde.d2b408",
		"name": "",
		"server": "4419a078.23234",
		"x": 1155.699951171875,
		"y": 445.3333282470703,
		"wires": []
	}, {
		"id": "cf38306a.e7073",
		"type": "socketio-leave",
		"z": "da8f7bde.d2b408",
		"name": "",
		"server": "4419a078.23234",
		"x": 1165.63330078125,
		"y": 483.8000030517578,
		"wires": []
	}, {
		"id": "6f348e91.0f8e98",
		"type": "function",
		"z": "da8f7bde.d2b408",
		"name": "leave room",
		"func": "let room_id = \"\";\n\nif(msg.socketIOEvent==\"leave\"){\n    room_id = msg.payload;\n}else if(msg.socketIOEvent==\"disconnect\"){\n    room_id = msg.socketIOStaticProperties?msg.socketIOStaticProperties.room:\"\";\n}\n\nmsg.payload = {\n    room: room_id\n};\n\nRED.util.setMessageProperty(\n    msg, \"socketIOEmit\", \"emit\", true);\n\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 953.4666748046875,
		"y": 483.56666564941406,
		"wires": [["cf38306a.e7073", "cc3d78e6.2eb7f8", "8767060f.1eb65", "46a3e44a.9d180c"]]
	}, {
		"id": "cc3d78e6.2eb7f8",
		"type": "socketio-out",
		"z": "da8f7bde.d2b408",
		"name": "",
		"server": "d5c1b5fd.4dfad8",
		"x": 1155.4667358398438,
		"y": 521.5666656494141,
		"wires": []
	}, {
		"id": "bacab9aa.9e48b8",
		"type": "debug",
		"z": "da8f7bde.d2b408",
		"name": "MSG OUT",
		"active": true,
		"tosidebar": true,
		"console": false,
		"tostatus": false,
		"complete": "true",
		"x": 1406.5669555664062,
		"y": 677.5666656494141,
		"wires": []
	}, {
		"id": "c1ac7b2d.b8cfe",
		"type": "debug",
		"z": "da8f7bde.d2b408",
		"name": "MSG OUT",
		"active": false,
		"tosidebar": true,
		"console": false,
		"tostatus": false,
		"complete": "true",
		"x": 1147.566650390625,
		"y": 406.566650390625,
		"wires": []
	}, {
		"id": "8767060f.1eb65",
		"type": "debug",
		"z": "da8f7bde.d2b408",
		"name": "MSG OUT",
		"active": false,
		"tosidebar": true,
		"console": false,
		"tostatus": false,
		"complete": "true",
		"x": 1144.566650390625,
		"y": 561.5666198730469,
		"wires": []
	}, {
		"id": "fe8e1e52.aca93",
		"type": "inject",
		"z": "da8f7bde.d2b408",
		"name": "",
		"topic": "",
		"payload": "",
		"payloadType": "date",
		"repeat": "",
		"crontab": "",
		"once": false,
		"onceDelay": 0.1,
		"x": 964.36669921875,
		"y": 311.00001525878906,
		"wires": [["46a3e44a.9d180c"]]
	}, {
		"id": "8ca03bf4.2ef41",
		"type": "debug",
		"z": "da8f7bde.d2b408",
		"name": "",
		"active": true,
		"tosidebar": true,
		"console": false,
		"tostatus": false,
		"complete": "false",
		"x": 1335.36669921875,
		"y": 310.75001525878906,
		"wires": []
	}, {
		"id": "46a3e44a.9d180c",
		"type": "function",
		"z": "da8f7bde.d2b408",
		"name": "chat_status",
		"func": "\nvar chat_status = context.get(\"chat_status\");\nchat_status = chat_status!=null ? chat_status : {};\n\nif( typeof msg.payload ==\"number\"){\n    \n    return {\n        payload:chat_status\n    };\n    \n}else{\n    \n    if(msg.payload.room!=null){\n        \n        if(chat_status[msg.payload.room]==null){\n            chat_status[msg.payload.room]=0;\n        }\n        \n        if(msg.socketIOEvent==\"enter\"){\n            chat_status[msg.payload.room]++;\n        }\n        \n        if(msg.socketIOEvent==\"leave\"){\n            chat_status[msg.payload.room]--;\n            chat_status[msg.payload.room] = chat_status[msg.payload.room]<0?0:chat_status[msg.payload.room];\n        }\n        \n        context.set(\"chat_status\",chat_status);\n        \n    }\n}",
		"outputs": 1,
		"noerr": 0,
		"x": 1158.36669921875,
		"y": 313.00001525878906,
		"wires": [["8ca03bf4.2ef41"]]
	}, {
		"id": "7a49043b.aada2c",
		"type": "mqtt in",
		"z": "da8f7bde.d2b408",
		"name": "",
		"topic": "socket_server_in",
		"qos": "2",
		"broker": "6fbdd64d.932d48",
		"x": 272.75,
		"y": 465.74998474121094,
		"wires": [["3d17f383.0db1fc"]]
	}, {
		"id": "80a7d71f.429b",
		"type": "mqtt out",
		"z": "da8f7bde.d2b408",
		"name": "",
		"topic": "socket_server_in",
		"qos": "",
		"retain": "",
		"broker": "6fbdd64d.932d48",
		"x": 508.25,
		"y": 406.1666564941406,
		"wires": []
	}, {
		"id": "87f13c2a.920eb8",
		"type": "function",
		"z": "da8f7bde.d2b408",
		"name": "",
		"func": "\nreturn {\n    payload:msg\n};",
		"outputs": 1,
		"noerr": 0,
		"x": 319.31671142578125,
		"y": 406.13330078125,
		"wires": [["80a7d71f.429b"]]
	}, {
		"id": "3d17f383.0db1fc",
		"type": "function",
		"z": "da8f7bde.d2b408",
		"name": "",
		"func": "\nreturn JSON.parse(msg.payload) ;",
		"outputs": 1,
		"noerr": 0,
		"x": 445.31671142578125,
		"y": 466.1332550048828,
		"wires": [["25998a28.5db1d6"]]
	}, {
		"id": "76e3c330.14a53c",
		"type": "watson-conversation-v1",
		"z": "da8f7bde.d2b408",
		"name": "",
		"workspaceid": "234bf172-8356-42cc-8ec3-cb0a3dc69a0c",
		"multiuser": true,
		"context": true,
		"empty-payload": false,
		"default-endpoint": true,
		"service-endpoint": "https://gateway.watsonplatform.net/conversation/api",
		"timeout": "",
		"optout-learning": false,
		"x": 846.4501953125,
		"y": 638.8332824707031,
		"wires": [["473f4e34.17ac38", "1ea1709e.199dcf"]]
	}, {
		"id": "55c71071.a9475",
		"type": "socketio-out",
		"z": "da8f7bde.d2b408",
		"name": "",
		"server": "d5c1b5fd.4dfad8",
		"x": 1427.2337036132812,
		"y": 728.5666809082031,
		"wires": []
	}, {
		"id": "46995860.4afcb",
		"type": "function",
		"z": "da8f7bde.d2b408",
		"name": "Source Type",
		"func": "\nif(msg.payload.type==\"client\"){\n    msg.payload_preserved = msg.payload;\n    return [msg,null];\n}else{\n    msg.payload_preserved = msg.payload;\n    return [null,msg];\n}\n",
		"outputs": 2,
		"noerr": 0,
		"x": 288.449951171875,
		"y": 734.6667175292969,
		"wires": [["ada5e176.1f9c9"], ["ffd27283.5745f8"]]
	}, {
		"id": "473f4e34.17ac38",
		"type": "function",
		"z": "da8f7bde.d2b408",
		"name": "",
		"func": "msg.payload_preserved.intents = msg.payload.intents;\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 1010.4501342773438,
		"y": 667.6666564941406,
		"wires": [["ffd27283.5745f8"]]
	}, {
		"id": "8b407712.00fb9",
		"type": "link in",
		"z": "da8f7bde.d2b408",
		"name": "Deal Message - B",
		"links": ["811411b9.d1e678"],
		"x": 174.4499969482422,
		"y": 736.6000213623047,
		"wires": [["46995860.4afcb", "c71d3ab.8b92048"]]
	}, {
		"id": "811411b9.d1e678",
		"type": "link out",
		"z": "da8f7bde.d2b408",
		"name": "Deal Message - A",
		"links": ["8b407712.00fb9"],
		"x": 931.449951171875,
		"y": 397.96669006347656,
		"wires": []
	}, {
		"id": "ada5e176.1f9c9",
		"type": "function",
		"z": "da8f7bde.d2b408",
		"name": "Message Type",
		"func": "let payload_preserved = msg.payload_preserved;\n\nif(payload_preserved.message.type==\"text\"){\n    msg.payload = payload_preserved.message.text;\n    msg.user = payload_preserved.from.name;\n    return [msg,null];\n}else{\n    msg.visual_recog_url = payload_preserved.message.url;\n    \n    return [null,msg];\n}\n",
		"outputs": 2,
		"noerr": 0,
		"x": 487.33331298828125,
		"y": 660.3334045410156,
		"wires": [["819ebfc7.2e53f8"], ["74086a02.246f44"]]
	}, {
		"id": "3b5c6a69.8c067e",
		"type": "catch",
		"z": "da8f7bde.d2b408",
		"name": "",
		"scope": ["340efc70.9569dc"],
		"x": 487.3332977294922,
		"y": 917.333251953125,
		"wires": [["a85903d8.bf13f8"]]
	}, {
		"id": "a85903d8.bf13f8",
		"type": "function",
		"z": "da8f7bde.d2b408",
		"name": "",
		"func": "let output_msg = \"\";\n/*\nif(msg.watsonerror.indexOf(\"Image size limit exceeded\")!=-1){\n    output_msg=\"這張圖太大了啦 看得我眼睛好痠... 能換換嗎?\";\n}else if(msg.watsonerror.indexOf(\"Key is over transaction limit\")!=-1){\n    output_msg=\"我只是個時薪120的工讀生，剛剛我已經辨識完我的工作份量了喔，今天打烊下次請早。\";\n}else if(msg.watsonerror.indexOf(\"service credentials\")!=-1){\n    output_msg=\"抱歉我看不太懂，可以用文字告訴我嗎？\";\n}else{\n    //已知原因有丟gif檔會得到 An undefined server error occurred.\n    output_msg=\"抱歉我看不太懂，可以換張圖片我看看？\";\n}*/\n\nmsg.recognitionResult = output_msg;\n\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 647.3332977294922,
		"y": 917.333251953125,
		"wires": [["f56b8521.8e449"]]
	}, {
		"id": "934c1dd5.279d5",
		"type": "link in",
		"z": "da8f7bde.d2b408",
		"name": "Line VisualRecog IN - B",
		"links": ["74086a02.246f44"],
		"x": 146.33331298828125,
		"y": 957.333251953125,
		"wires": [["a337b25e.9ff8c", "87fa54be.080148"]]
	}, {
		"id": "f56b8521.8e449",
		"type": "link out",
		"z": "da8f7bde.d2b408",
		"name": "Line VisualRecog OUT - A",
		"links": ["6bf9bc1d.06f314"],
		"x": 764.3333129882812,
		"y": 997.333251953125,
		"wires": []
	}, {
		"id": "68faefd2.801dd",
		"type": "function",
		"z": "da8f7bde.d2b408",
		"name": "",
		"func": "let output_msg = \"\";\n\nif(\n    msg.result &&\n    msg.result.images &&\n    msg.result.images[0] &&\n    msg.result.images[0].classifiers &&\n    msg.result.images[0].classifiers[0] &&\n    msg.result.images[0].classifiers[0].classes\n){\n    let labels = msg.result.images[0]\n                    .classifiers[0].classes;\n    labels.sort(function(a, b){\n        return b[\"score\"]-a[\"score\"];\n    });\n    labels.filter(function(item){\n        return item[\"score\"]>0.6;\n    });\n    output_msg = labels.map(function(item){\n       return item.class\n    }).join(\",\");\n}\n\nmsg.recognitionResult = output_msg;\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 618.3332977294922,
		"y": 957.3332214355469,
		"wires": [["63f7634.954551c"]]
	}, {
		"id": "63f7634.954551c",
		"type": "function",
		"z": "da8f7bde.d2b408",
		"name": "",
		"func": "\nmsg.payload = {\n    \"text\":msg.recognitionResult,\n    \"model_id\":\"en-zh-TW\"\n};\n\nmsg.headers = {\n    \"Content-Type\": \"application/json\",\n    \"Accepts\": \"application/json\",\n    \"Authorization\":\"Basic \" + new Buffer('8f2be220-38af-4e08-a0e9-2beeb4a7db1f' + \":\" + 'nEVxvfgyWmzV').toString(\"base64\")\n};\n\nmsg.url = \"https://gateway.watsonplatform.net/language-translator/api/v3/translate?version=2018-05-01\";\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 360.3332977294922,
		"y": 1007.3332214355469,
		"wires": [["b3d97dbe.ddf7"]]
	}, {
		"id": "b3d97dbe.ddf7",
		"type": "http request",
		"z": "da8f7bde.d2b408",
		"name": "",
		"method": "POST",
		"ret": "obj",
		"url": "",
		"tls": "",
		"x": 500.3332977294922,
		"y": 1007.3332214355469,
		"wires": [["b649c692.1fea68"]]
	}, {
		"id": "b649c692.1fea68",
		"type": "function",
		"z": "da8f7bde.d2b408",
		"name": "",
		"func": "let output_msg = \"\";\nif(\n    msg.payload.translations \n    && msg.payload.translations[0] \n    && msg.payload.translations[0].translation \n){\n    output_msg = msg.payload.translations[0].translation;\n}\n\nmsg.recognitionResult = output_msg;\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 640.3332977294922,
		"y": 1007.3332214355469,
		"wires": [["f56b8521.8e449", "3586d46d.f1b5dc"]]
	}, {
		"id": "a337b25e.9ff8c",
		"type": "function",
		"z": "da8f7bde.d2b408",
		"name": "",
		"func": "\nmsg.payload = msg.visual_recog_url;\n\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 258.33331298828125,
		"y": 957.333251953125,
		"wires": [["5c4bf8fc.707158"]]
	}, {
		"id": "340efc70.9569dc",
		"type": "visual-recognition-v3",
		"z": "da8f7bde.d2b408",
		"name": "圖片辨識",
		"apikey": "BTWdTzZJy6ugm65tGHYzOP1qbNYjFADAO2b3SE8MZC6W",
		"vr-service-endpoint": "https://gateway.watsonplatform.net/visual-recognition/api",
		"image-feature": "classifyImage",
		"lang": "en",
		"x": 472.3332977294922,
		"y": 958.333251953125,
		"wires": [["68faefd2.801dd", "cc24d8e5.e7469"]]
	}, {
		"id": "6ea8c3.db85073c",
		"type": "function",
		"z": "da8f7bde.d2b408",
		"name": "",
		"func": "msg.payload_preserved.recognitionResult = msg.recognitionResult;\n\nmsg.payload = msg.recognitionResult;\nmsg.user = msg.payload_preserved.from.name;\n\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 691.9999389648438,
		"y": 673.3334045410156,
		"wires": [["819ebfc7.2e53f8"]]
	}, {
		"id": "6bf9bc1d.06f314",
		"type": "link in",
		"z": "da8f7bde.d2b408",
		"name": "Line VisualRecog OUT - B",
		"links": ["f56b8521.8e449"],
		"x": 566.9999389648438,
		"y": 706.0000305175781,
		"wires": [["6ea8c3.db85073c"]]
	}, {
		"id": "74086a02.246f44",
		"type": "link out",
		"z": "da8f7bde.d2b408",
		"name": "Line VisualRecog IN - A",
		"links": ["934c1dd5.279d5"],
		"x": 637,
		"y": 707.3334045410156,
		"wires": []
	}, {
		"id": "3586d46d.f1b5dc",
		"type": "debug",
		"z": "da8f7bde.d2b408",
		"name": "Translate OUT",
		"active": false,
		"tosidebar": true,
		"console": false,
		"tostatus": false,
		"complete": "true",
		"x": 826.3333129882812,
		"y": 1049.3333740234375,
		"wires": []
	}, {
		"id": "cc24d8e5.e7469",
		"type": "debug",
		"z": "da8f7bde.d2b408",
		"name": "Recog OUT",
		"active": false,
		"tosidebar": true,
		"console": false,
		"tostatus": false,
		"complete": "true",
		"x": 816.566650390625,
		"y": 958.1666870117188,
		"wires": []
	}, {
		"id": "1ea1709e.199dcf",
		"type": "debug",
		"z": "da8f7bde.d2b408",
		"name": "Assistant OUT",
		"active": false,
		"tosidebar": true,
		"console": false,
		"tostatus": false,
		"complete": "true",
		"x": 1039.75,
		"y": 604.75,
		"wires": []
	}, {
		"id": "819ebfc7.2e53f8",
		"type": "function",
		"z": "da8f7bde.d2b408",
		"name": "setting",
		"func": "msg.params = {\n    alternate_intents: true,\n    timeout: 9*1000\n};\n\nif(msg.payload == \"\" || msg.payload == null ){\n    msg.payload = \" \";\n} \nmsg.payload = msg.payload.replace(/[\\t\\n\\r]/g,\"\");\n\n\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 701.36669921875,
		"y": 618,
		"wires": [["76e3c330.14a53c", "c85debdb.43b06"]]
	}, {
		"id": "5160cff2.1784d8",
		"type": "comment",
		"z": "da8f7bde.d2b408",
		"name": "圖像辨識",
		"info": "因為recog的service讀不到localhost的檔案 \n目前先把檔案內容讀回來",
		"x": 144.36666870117188,
		"y": 872.5,
		"wires": []
	}, {
		"id": "7604a9e5.a8e5e",
		"type": "comment",
		"z": "da8f7bde.d2b408",
		"name": "訊息處理",
		"info": "",
		"x": 150.75,
		"y": 570.5,
		"wires": []
	}, {
		"id": "fd293ca5.215de8",
		"type": "comment",
		"z": "da8f7bde.d2b408",
		"name": "Socket 進入點",
		"info": "",
		"x": 134.75,
		"y": 330,
		"wires": []
	}, {
		"id": "185370ef.145047",
		"type": "comment",
		"z": "da8f7bde.d2b408",
		"name": "Error Handling",
		"info": "",
		"x": 137.75,
		"y": 179,
		"wires": []
	}, {
		"id": "c71d3ab.8b92048",
		"type": "debug",
		"z": "da8f7bde.d2b408",
		"name": "Message Parse",
		"active": false,
		"tosidebar": true,
		"console": false,
		"tostatus": false,
		"complete": "true",
		"x": 317.33331298828125,
		"y": 783.3333129882812,
		"wires": []
	}, {
		"id": "87fa54be.080148",
		"type": "debug",
		"z": "da8f7bde.d2b408",
		"name": "Picture Parse",
		"active": false,
		"tosidebar": true,
		"console": false,
		"tostatus": false,
		"complete": "true",
		"x": 335.33331298828125,
		"y": 893.3333129882812,
		"wires": []
	}, {
		"id": "c85debdb.43b06",
		"type": "debug",
		"z": "da8f7bde.d2b408",
		"name": "Go Assistant",
		"active": false,
		"tosidebar": true,
		"console": false,
		"tostatus": false,
		"complete": "true",
		"x": 846.566650390625,
		"y": 569.7666625976562,
		"wires": []
	}, {
		"id": "3470fabc.8254fe",
		"type": "http request",
		"z": "da8f7bde.d2b408",
		"name": "",
		"method": "GET",
		"ret": "bin",
		"url": "",
		"tls": "",
		"x": 354.3666687011719,
		"y": 1136,
		"wires": [["340efc70.9569dc"]]
	}, {
		"id": "5c4bf8fc.707158",
		"type": "function",
		"z": "da8f7bde.d2b408",
		"name": "",
		"func": "msg.url = msg.payload;\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 201.36666870117188,
		"y": 1136.5,
		"wires": [["3470fabc.8254fe"]]
	}, {
		"id": "c207cd6d.45c4f8",
		"type": "http in",
		"z": "da8f7bde.d2b408",
		"name": "",
		"url": "/taipei_digital_api/manager_identity",
		"method": "get",
		"upload": false,
		"swaggerDoc": "",
		"x": 264.3666687011719,
		"y": 1316.5,
		"wires": [["1f38697a.6db277"]]
	}, {
		"id": "c501bde2.42963",
		"type": "function",
		"z": "da8f7bde.d2b408",
		"name": "",
		"func": "msg.payload = [{\n\t\t\"id\": \"3fb#23EV72uAr&FAA@fy\",\n\t\t\"type\": \"CT200H\",\n\t\t\"vehicle_id\": \"ABZ-1234\",\n\t\t\"name\": \"王大明\",\n\t\t\"avatar\": \"/images/avatar.png\",\n\t\t\"unread\": 2,\n\t\t\"latest_msg\": [{\n\t\t\t\t\"msg\": \"是的\",\n\t\t\t\t\"time\": \"2019/09/20 10:11:50\"\n\t\t\t}\n\t\t],\n\t\t\"note\": [{\n\t\t\t\t\"msg\": \"生日\"\n\t\t\t}\n\t\t]\n\t}, {\n\t\t\"id\": \"B%UnVWu7&*7tatpL4KHr\",\n\t\t\"type\": \"ES200\",\n\t\t\"vehicle_id\": \"ABE-1234\",\n\t\t\"name\": \"陳大為\",\n\t\t\"avatar\": \"/images/avatar.png\",\n\t\t\"unread\": 4,\n\t\t\"latest_msg\": [{\n\t\t\t\t\"msg\": \"謝謝！！\",\n\t\t\t\t\"time\": \"2019/09/18 14:05:03\"\n\t\t\t}\n\t\t],\n\t\t\"note\": [{\n\t\t\t\t\"msg\": \"保險到期日09/26\"\n\t\t\t}\n\t\t]\n\t}, {\n\t\t\"id\": \"UWtqzPU9@&smq9b&KVvf\",\n\t\t\"type\": \"RX450H\",\n\t\t\"vehicle_id\": \"ACE-8866\",\n\t\t\"name\": \"林小東\",\n\t\t\"avatar\": \"/images/avatar.png\",\n\t\t\"unread\": 0,\n\t\t\"latest_msg\": [{\n\t\t\t\t\"msg\": \"感謝您！\",\n\t\t\t\t\"time\": \"2019/09/21 08:05:15\"\n\t\t\t}\n\t\t],\n\t\t\"note\": []\n\t}, {\n\t\t\"id\": \"KEpz5bFFx&mnzd5UZfZf\",\n\t\t\"type\": \"GS300\",\n\t\t\"vehicle_id\": \"LXS-8888\",\n\t\t\"name\": \"吳小涵\",\n\t\t\"avatar\": \"/images/avatar.png\",\n\t\t\"unread\": 0,\n\t\t\"latest_msg\": [{\n\t\t\t\t\"msg\": \"了解\",\n\t\t\t\t\"time\": \"2019/09/15 18:35:07\"\n\t\t\t}\n\t\t],\n\t\t\"note\": []\n\t}, {\n\t\t\"id\": \"Qr8zrWexwdXtbHQkV5bY\",\n\t\t\"type\": \"NX200\",\n\t\t\"vehicle_id\": \"AAA-0000\",\n\t\t\"name\": \"李小龍\",\n\t\t\"avatar\": \"/images/avatar.png\",\n\t\t\"unread\": 0,\n\t\t\"latest_msg\": [{\n\t\t\t\t\"msg\": \"您已寄出一張圖片\",\n\t\t\t\t\"time\": \"2019/09/17 12:00:44\"\n\t\t\t}\n\t\t],\n\t\t\"note\": []\n\t}\n]\n\n\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 566.36669921875,
		"y": 1363,
		"wires": [["770e744f.10202c"]]
	}, {
		"id": "7776e800.e7c17",
		"type": "http in",
		"z": "da8f7bde.d2b408",
		"name": "",
		"url": "/taipei_digital_api/manager_responsibility",
		"method": "get",
		"upload": false,
		"swaggerDoc": "",
		"x": 282.75,
		"y": 1363.25,
		"wires": [["c501bde2.42963"]]
	}, {
		"id": "1f38697a.6db277",
		"type": "function",
		"z": "da8f7bde.d2b408",
		"name": "",
		"func": "msg.payload = {\n    \"成功與否\":\"success\",\n    \"ht_id\":\"SA0001\",\n    \"type\":\"Sales\",\n    \"經銷商\":\"AAA\",\n    \"據點別\":\"AAA\",\n    \"品牌\":\"AAA\",\n    \"帳號\":\"AAA\",\n    \"姓名\":\"AAA\"\n};\n\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 554.75,
		"y": 1315.75,
		"wires": [["9bed329a.06b0a"]]
	}, {
		"id": "9bed329a.06b0a",
		"type": "http response",
		"z": "da8f7bde.d2b408",
		"name": "",
		"statusCode": "",
		"headers": {},
		"x": 784.36669921875,
		"y": 1315.75,
		"wires": []
	}, {
		"id": "770e744f.10202c",
		"type": "http response",
		"z": "da8f7bde.d2b408",
		"name": "",
		"statusCode": "",
		"headers": {},
		"x": 792.36669921875,
		"y": 1362.75,
		"wires": []
	}, {
		"id": "d7d43f31.7dc92",
		"type": "function",
		"z": "da8f7bde.d2b408",
		"name": "",
		"func": "msg.payload = {\n\t\"address\": \"AAA\",\n\t\"tel\": \"AAA\",\n\t\"生日\": \"AAA\",\n\t\"車名 SFX\": \"AAA\",\n\t\"新車交車日\": \"AAA\",\n\t\"強制任意險到期日\": \"AAA\",\n\t\"上一次待修建議\": \"AAA\",\n\t\"上一次維修紀錄\": {}\n};\n\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 569.61669921875,
		"y": 1410.25,
		"wires": [["751902f6.017fec"]]
	}, {
		"id": "f2dbad68.27f2",
		"type": "http in",
		"z": "da8f7bde.d2b408",
		"name": "",
		"url": "/taipei_digital_api/vehicle_owner",
		"method": "get",
		"upload": false,
		"swaggerDoc": "",
		"x": 256,
		"y": 1410.5,
		"wires": [["d7d43f31.7dc92"]]
	}, {
		"id": "751902f6.017fec",
		"type": "http response",
		"z": "da8f7bde.d2b408",
		"name": "",
		"statusCode": "",
		"headers": {},
		"x": 795.61669921875,
		"y": 1410,
		"wires": []
	}, {
		"id": "75fac16d.d7c63",
		"type": "function",
		"z": "da8f7bde.d2b408",
		"name": "",
		"func": "msg.payload = {};\n\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 568.61669921875,
		"y": 1459.25,
		"wires": [["6f4e1cc9.98d81c"]]
	}, {
		"id": "a3e20106.98852",
		"type": "http in",
		"z": "da8f7bde.d2b408",
		"name": "",
		"url": "/taipei_digital_api/reservation",
		"method": "get",
		"upload": false,
		"swaggerDoc": "",
		"x": 245,
		"y": 1459.5,
		"wires": [["75fac16d.d7c63"]]
	}, {
		"id": "6f4e1cc9.98d81c",
		"type": "http response",
		"z": "da8f7bde.d2b408",
		"name": "",
		"statusCode": "",
		"headers": {},
		"x": 794.61669921875,
		"y": 1459,
		"wires": []
	}, {
		"id": "c840f08e.f1f9f8",
		"type": "comment",
		"z": "da8f7bde.d2b408",
		"name": "台北數位API (未完成)",
		"info": "",
		"x": 120.36666870117188,
		"y": 1234.5,
		"wires": []
	}, {
		"id": "fafb17b5.e22db",
		"type": "comment",
		"z": "da8f7bde.d2b408",
		"name": "資料庫會做的事(未完成)",
		"info": "預計接在 socket 後的 checkEvent 之後",
		"x": 130.75,
		"y": 1553.75,
		"wires": []
	}, {
		"id": "51c5fe01.aeb88",
		"type": "switch",
		"z": "da8f7bde.d2b408",
		"name": "",
		"property": "payload",
		"propertyType": "msg",
		"rules": [{
				"t": "eq",
				"v": "寫入對話",
				"vt": "str"
			}, {
				"t": "eq",
				"v": "用戶_讀最後一筆歷史對話資料",
				"vt": "str"
			}, {
				"t": "eq",
				"v": "用戶_讀歷史對話資料",
				"vt": "str"
			}, {
				"t": "eq",
				"v": "管理者_讀未讀對話資料",
				"vt": "str"
			}, {
				"t": "eq",
				"v": "管理者_讀歷史對話資料",
				"vt": "str"
			}, {
				"t": "eq",
				"v": "更新responsibility資料",
				"vt": "str"
			}
		],
		"checkall": "true",
		"repair": false,
		"outputs": 6,
		"x": 234.36666870117188,
		"y": 1678,
		"wires": [["66852488.f707fc"], ["ae634843.a4483"], ["cb492865.e7efa8"], ["62b54256.e863cc"], ["e2733ef0.e4a4"], ["96ac4787.2dafd8"]]
	}, {
		"id": "66852488.f707fc",
		"type": "function",
		"z": "da8f7bde.d2b408",
		"name": "寫入對話",
		"func": "\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 485.36669921875,
		"y": 1559.5,
		"wires": [[]]
	}, {
		"id": "ae634843.a4483",
		"type": "function",
		"z": "da8f7bde.d2b408",
		"name": "用戶_讀最後一筆歷史對話資料",
		"func": "\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 555.36669921875,
		"y": 1602.5,
		"wires": [[]]
	}, {
		"id": "cb492865.e7efa8",
		"type": "function",
		"z": "da8f7bde.d2b408",
		"name": "用戶_讀歷史對話資料",
		"func": "\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 527.75,
		"y": 1646.75,
		"wires": [[]]
	}, {
		"id": "62b54256.e863cc",
		"type": "function",
		"z": "da8f7bde.d2b408",
		"name": "管理者_讀未讀對話資料",
		"func": "\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 537.75,
		"y": 1689.75,
		"wires": [[]]
	}, {
		"id": "e2733ef0.e4a4",
		"type": "function",
		"z": "da8f7bde.d2b408",
		"name": "管理者_讀歷史對話資料",
		"func": "\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 537.75,
		"y": 1736.75,
		"wires": [[]]
	}, {
		"id": "96ac4787.2dafd8",
		"type": "function",
		"z": "da8f7bde.d2b408",
		"name": "更新responsibility資料",
		"func": "\nreturn msg;",
		"outputs": 1,
		"noerr": 0,
		"x": 527.75,
		"y": 1779.75,
		"wires": [[]]
	}, {
		"id": "d5c1b5fd.4dfad8",
		"type": "socketio-config",
		"z": "",
		"port": "1881",
		"sendClient": "true",
		"path": "/socket.io",
		"bindToNode": true
	}, {
		"id": "4419a078.23234",
		"type": "socketio-config",
		"z": "",
		"port": "1881",
		"sendClient": "true",
		"path": "/socket.io",
		"bindToNode": true
	}, {
		"id": "6fbdd64d.932d48",
		"type": "mqtt-broker",
		"z": "",
		"name": "",
		"broker": "192.168.112.166",
		"port": "1883",
		"clientid": "",
		"usetls": false,
		"compatmode": true,
		"keepalive": "60",
		"cleansession": true,
		"birthTopic": "",
		"birthQos": "0",
		"birthPayload": "",
		"closeTopic": "",
		"closeQos": "0",
		"closePayload": "",
		"willTopic": "",
		"willQos": "0",
		"willPayload": ""
	}
]
